# AI 指導提示詞功能測試指南

## 🎯 功能說明

AI 指導提示詞功能允許 MCP 工具在返回數據時嵌入動態的分析指導，控制二次 AI 調用的重點和方向。

## 🧪 測試步驟

### 1. 啟動服務
```bash
# 後端
cd backend && npm start

# 前端
cd frontend && npm run dev
```

### 2. 打開聊天頁面
訪問前端聊天功能頁面

### 3. 測試不同場景

#### 測試案例 1：高風險專案查詢
**輸入問題**：
```
延遲超過10天的專案有哪些？請分析風險和建議
```

**預期結果**：
- AI 會調用 `get_mil_list` 工具
- 工具調用結果中會顯示「🧠 AI 分析指導」區塊
- 指導內容包含：
  - 🚨 高風險延遲專案需要立即關注
  - 檢視 DRI 負責人分工
  - 優先處理延遲最嚴重的前3個專案
- AI 最終回應會特別關注風險分析和緊急建議

#### 測試案例 2：地點專案查詢
**輸入問題**：
```
C#3FOQC地點的專案執行情況如何？
```

**預期結果**：
- 指導內容包含：
  - 🏭 專注於該地點的專案執行情況
  - 評估地點系統性問題
- AI 回應會專注於地點相關的系統性分析

#### 測試案例 3：一般專案查詢
**輸入問題**：
```
目前有哪些進行中的專案？
```

**預期結果**：
- 指導內容較為基礎
- AI 回應風格比較中性，不會過度強調風險

## 🔍 驗證要點

### 前端顯示驗證
1. **工具調用區域**：展開工具調用結果
2. **AI 指導區塊**：查看是否顯示藍色的「🧠 AI 分析指導」區塊
3. **指導內容**：檢查指導文字是否根據查詢條件動態變化

### AI 回應驗證
1. **回應重點**：不同類型查詢的 AI 回應重點應明顯不同
2. **關鍵詞檢查**：
   - 高風險查詢 → 「立即關注」、「風險」、「優先」等詞
   - 地點查詢 → 「地點」、「系統性」、「該位置」等詞
3. **建議具體性**：AI 應提供具體可執行的建議

### 瀏覽器開發者工具驗證
1. **F12 開發者工具** → **Network 標籤**
2. **發起測試查詢**
3. **查看 `/api/chat/send` 請求的 Response**
4. **檢查是否包含**：
   ```json
   {
     "formatted_results": "### 🧠 AI 分析指導\n請重點關注以下專案管理要點：..."
   }
   ```

## 🎨 前端顯示效果

成功時您會看到：

```
┌─────────────────────────────────────────┐
│ 🧠 AI 分析指導              [動態生成]  │
├─────────────────────────────────────────┤
│ 請重點關注以下專案管理要點：             │
│ 1. 🚨 這些都是高風險延遲專案...         │
│ 2. 請特別檢視 DRI（負責人）的分工...    │
│ ...                                     │
│                                         │
│ ℹ️ 此指導會影響 AI 的分析重點和回應風格  │
└─────────────────────────────────────────┘
```

## 🚫 問題排查

### 如果沒有顯示 AI 指導區塊：
1. 檢查工具是否成功調用 `get_mil_list`
2. 確認後端 MIL 服務已包含 `aiInstructions` 修改
3. 檢查 `mcpToolParser.service.js` 是否正確格式化

### 如果 AI 回應沒有變化：
1. 確認二次 AI 調用是否啟用
2. 檢查系統提示詞是否包含 AI 指導規則
3. 查看後端日誌是否有錯誤

## 📝 成功標誌

✅ **完全成功**：
- 前端顯示藍色 AI 指導區塊
- 指導內容根據查詢動態變化
- AI 回應明顯遵循指導重點
- 不同查詢類型回應風格差異明顯

✅ **部分成功**：
- 有 AI 指導顯示，但內容不夠動態
- AI 回應有些變化，但不夠明顯

❌ **未成功**：
- 沒有 AI 指導區塊顯示
- AI 回應完全沒有差異 