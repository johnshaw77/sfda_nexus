<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0" />
    <title>OpenCC æ–‡å­—è½‰æ›æ¸¬è©¦</title>
    <style>
      body {
        font-family: "Microsoft YaHei", sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #e8e8e8;
        border-radius: 6px;
      }
      .test-title {
        color: #1890ff;
        font-weight: bold;
        margin-bottom: 10px;
      }
      textarea {
        width: 100%;
        min-height: 100px;
        padding: 10px;
        border: 1px solid #d9d9d9;
        border-radius: 4px;
        font-family: inherit;
        resize: vertical;
      }
      button {
        background: #1890ff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px 5px 5px 0;
      }
      button:hover {
        background: #40a9ff;
      }
      button:disabled {
        background: #d9d9d9;
        cursor: not-allowed;
      }
      .result {
        background: #f6ffed;
        border: 1px solid #b7eb8f;
        border-radius: 4px;
        padding: 10px;
        margin-top: 10px;
      }
      .error {
        background: #fff2f0;
        border: 1px solid #ffccc7;
        color: #a8071a;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 20px;
      }
      .status.success {
        background: #f6ffed;
        border: 1px solid #b7eb8f;
        color: #389e0d;
      }
      .status.error {
        background: #fff2f0;
        border: 1px solid #ffccc7;
        color: #a8071a;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ”„ OpenCC æ–‡å­—è½‰æ›æ¸¬è©¦</h1>

      <!-- ç‹€æ…‹é¡¯ç¤º -->
      <div
        id="status"
        class="status">
        æ­£åœ¨åˆå§‹åŒ– OpenCC...
      </div>

      <!-- é è¨­æ¸¬è©¦ -->
      <div class="test-section">
        <div class="test-title">ğŸ“ é è¨­æ¸¬è©¦æ–‡æœ¬</div>
        <button onclick="testSimplified()">æ¸¬è©¦ç°¡é«”è½‰ç¹é«”</button>
        <button onclick="testTraditional()">æ¸¬è©¦ç¹é«”è½‰ç°¡é«”</button>
        <button onclick="testThinking()">æ¸¬è©¦æ€è€ƒå…§å®¹</button>
        <div
          id="presetResult"
          class="result"
          style="display: none"></div>
      </div>

      <!-- è‡ªå®šç¾©æ¸¬è©¦ -->
      <div class="test-section">
        <div class="test-title">âœï¸ è‡ªå®šç¾©æ–‡æœ¬æ¸¬è©¦</div>
        <textarea
          id="inputText"
          placeholder="è«‹è¼¸å…¥è¦è½‰æ›çš„æ–‡æœ¬..."></textarea>
        <br />
        <button onclick="convertS2T()">ç°¡é«”è½‰ç¹é«”</button>
        <button onclick="convertT2S()">ç¹é«”è½‰ç°¡é«”</button>
        <button onclick="autoConvert()">è‡ªå‹•è½‰æ›</button>
        <div
          id="customResult"
          class="result"
          style="display: none"></div>
      </div>

      <!-- æ€è€ƒå…§å®¹æ¨¡æ“¬æ¸¬è©¦ -->
      <div class="test-section">
        <div class="test-title">ğŸ§  æ€è€ƒå…§å®¹ä¸²æµæ¨¡æ“¬</div>
        <button onclick="simulateStream()">æ¨¡æ“¬ä¸²æµè½‰æ›</button>
        <button onclick="clearStream()">æ¸…é™¤</button>
        <div
          id="streamContainer"
          style="margin-top: 10px">
          <div>åŸå§‹ä¸²æµ:</div>
          <div
            id="originalStream"
            style="
              background: #f0f0f0;
              padding: 10px;
              border-radius: 4px;
              margin: 5px 0;
            "></div>
          <div>è½‰æ›å¾Œä¸²æµ:</div>
          <div
            id="convertedStream"
            style="
              background: #e6f7ff;
              padding: 10px;
              border-radius: 4px;
              margin: 5px 0;
            "></div>
        </div>
      </div>
    </div>

    <script type="module">
      import { Converter } from "./frontend/node_modules/opencc-js/dist/opencc.esm.js";

      let s2tConverter = null;
      let t2sConverter = null;

      // æ¸¬è©¦æ–‡æœ¬
      const testTexts = {
        simplified:
          "æˆ‘æ­£åœ¨æ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚ç°åœ¨éœ€è¦åˆ†æç”¨æˆ·çš„éœ€æ±‚ï¼Œç„¶åæä¾›æœ€åˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬æ•°æ®å¤„ç†ã€ç®—æ³•ä¼˜åŒ–å’Œç»“æœéªŒè¯ã€‚",
        traditional:
          "æˆ‘æ­£åœ¨æ€è€ƒé€™å€‹å•é¡Œã€‚ç¾åœ¨éœ€è¦åˆ†æç”¨æˆ¶çš„éœ€æ±‚ï¼Œç„¶å¾Œæä¾›æœ€åˆé©çš„è§£æ±ºæ–¹æ¡ˆã€‚é€™å€‹éç¨‹åŒ…æ‹¬è³‡æ–™è™•ç†ã€æ¼”ç®—æ³•å„ªåŒ–å’Œçµæœé©—è­‰ã€‚",
        thinking: `æˆ‘æ¥æ€è€ƒä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼š

ç”¨æˆ·è¯¢é—®å…³äºæ•°æ®åˆ†æçš„é—®é¢˜ã€‚æˆ‘éœ€è¦ï¼š
1. ç†è§£ç”¨æˆ·çš„å…·ä½“éœ€æ±‚
2. åˆ†æç°æœ‰çš„æ•°æ®ç»“æ„
3. æä¾›åˆé€‚çš„åˆ†ææ–¹æ³•
4. ç»™å‡ºå®é™…çš„å®ç°æ­¥éª¤

è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°æœºå™¨å­¦ä¹ ã€ç»Ÿè®¡åˆ†æå’Œæ•°æ®å¯è§†åŒ–ç­‰å¤šä¸ªé¢†åŸŸã€‚æˆ‘åº”è¯¥ä»æœ€åŸºç¡€çš„æ•°æ®é¢„å¤„ç†å¼€å§‹ï¼Œç„¶åé€æ­¥æ·±å…¥åˆ°å¤æ‚çš„åˆ†æç®—æ³•ã€‚`,
      };

      // åˆå§‹åŒ–è½‰æ›å™¨
      async function initConverters() {
        try {
          s2tConverter = Converter({ from: "cn", to: "tw" });
          t2sConverter = Converter({ from: "tw", to: "cn" });

          document.getElementById("status").innerHTML =
            "âœ… OpenCC åˆå§‹åŒ–æˆåŠŸï¼";
          document.getElementById("status").className = "status success";

          // å•Ÿç”¨æ‰€æœ‰æŒ‰éˆ•
          const buttons = document.querySelectorAll("button");
          buttons.forEach((btn) => (btn.disabled = false));
        } catch (error) {
          console.error("OpenCC åˆå§‹åŒ–å¤±æ•—:", error);
          document.getElementById(
            "status"
          ).innerHTML = `âŒ OpenCC åˆå§‹åŒ–å¤±æ•—: ${error.message}`;
          document.getElementById("status").className = "status error";
        }
      }

      // é¡¯ç¤ºçµæœ
      function showResult(elementId, original, converted, method) {
        const element = document.getElementById(elementId);
        element.innerHTML = `
                <strong>${method}</strong><br>
                <strong>åŸæ–‡:</strong> ${original}<br>
                <strong>è½‰æ›:</strong> ${converted}
            `;
        element.style.display = "block";
      }

      // é è¨­æ¸¬è©¦å‡½æ•¸
      function testSimplified() {
        if (!s2tConverter) return alert("è½‰æ›å™¨æœªåˆå§‹åŒ–");
        const converted = s2tConverter(testTexts.simplified);
        showResult(
          "presetResult",
          testTexts.simplified,
          converted,
          "ç°¡é«”è½‰ç¹é«”"
        );
      }

      window.testTraditional = function () {
        if (!t2sConverter) return alert("è½‰æ›å™¨æœªåˆå§‹åŒ–");
        const converted = t2sConverter(testTexts.traditional);
        showResult(
          "presetResult",
          testTexts.traditional,
          converted,
          "ç¹é«”è½‰ç°¡é«”"
        );
      };

      window.testThinking = function () {
        if (!s2tConverter) return alert("è½‰æ›å™¨æœªåˆå§‹åŒ–");
        const converted = s2tConverter(testTexts.thinking);
        showResult(
          "presetResult",
          testTexts.thinking,
          converted,
          "æ€è€ƒå…§å®¹è½‰æ›"
        );
      };

      // è‡ªå®šç¾©æ¸¬è©¦å‡½æ•¸
      window.convertS2T = function () {
        if (!s2tConverter) return alert("è½‰æ›å™¨æœªåˆå§‹åŒ–");
        const input = document.getElementById("inputText").value;
        if (!input.trim()) return alert("è«‹è¼¸å…¥æ–‡æœ¬");

        const converted = s2tConverter(input);
        showResult("customResult", input, converted, "ç°¡é«”è½‰ç¹é«”");
      };

      window.convertT2S = function () {
        if (!t2sConverter) return alert("è½‰æ›å™¨æœªåˆå§‹åŒ–");
        const input = document.getElementById("inputText").value;
        if (!input.trim()) return alert("è«‹è¼¸å…¥æ–‡æœ¬");

        const converted = t2sConverter(input);
        showResult("customResult", input, converted, "ç¹é«”è½‰ç°¡é«”");
      };

      window.autoConvert = function () {
        if (!s2tConverter) return alert("è½‰æ›å™¨æœªåˆå§‹åŒ–");
        const input = document.getElementById("inputText").value;
        if (!input.trim()) return alert("è«‹è¼¸å…¥æ–‡æœ¬");

        // ç°¡å–®æª¢æ¸¬ï¼ˆèˆ‡å‰ç«¯ä»£ç¢¼ä¸€è‡´ï¼‰
        const simplifiedChars = [
          "å›½",
          "å­¦",
          "è¯­",
          "æ—¶",
          "é—´",
          "å‘",
          "è¯´",
          "é—®",
          "é¢˜",
          "ç°",
          "å®",
          "åº”",
          "è¯¥",
          "è¿™",
          "æ ·",
          "é‚£",
          "æ ·",
        ];
        const hasSimplified = simplifiedChars.some((char) =>
          input.includes(char)
        );

        if (hasSimplified) {
          const converted = s2tConverter(input);
          showResult("customResult", input, converted, "è‡ªå‹•è½‰æ› (ç°¡â†’ç¹)");
        } else {
          showResult("customResult", input, input, "è‡ªå‹•è½‰æ› (ç„¡éœ€è½‰æ›)");
        }
      };

      // ä¸²æµæ¨¡æ“¬
      window.simulateStream = function () {
        if (!s2tConverter) return alert("è½‰æ›å™¨æœªåˆå§‹åŒ–");

        const originalContainer = document.getElementById("originalStream");
        const convertedContainer = document.getElementById("convertedStream");

        // æ¨¡æ“¬æ€è€ƒå…§å®¹é€æ­¥ç”¢ç”Ÿ
        const streamText =
          "æˆ‘æ­£åœ¨æ€è€ƒè¿™ä¸ªå¤æ‚çš„é—®é¢˜ã€‚é¦–å…ˆéœ€è¦åˆ†æç”¨æˆ·çš„å…·ä½“éœ€æ±‚ï¼Œç„¶åæŸ¥æ‰¾ç›¸å…³çš„æ•°æ®å’Œèµ„æ–™ã€‚æ¥ä¸‹æ¥è¦è®¾è®¡åˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç®—æ³•é€‰æ‹©ã€å‚æ•°è°ƒä¼˜å’Œç»“æœéªŒè¯ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ç»¼åˆè€ƒè™‘æ•ˆç‡ã€å‡†ç¡®æ€§å’Œå¯æ‰©å±•æ€§ç­‰å¤šä¸ªå› ç´ ã€‚";

        originalContainer.innerHTML = "";
        convertedContainer.innerHTML = "";

        let currentText = "";
        let index = 0;

        const timer = setInterval(() => {
          if (index < streamText.length) {
            currentText += streamText[index];
            originalContainer.textContent = currentText;

            // å³æ™‚è½‰æ›
            const converted = s2tConverter(currentText);
            convertedContainer.textContent = converted;

            index++;
          } else {
            clearInterval(timer);
          }
        }, 100);
      };

      window.clearStream = function () {
        document.getElementById("originalStream").innerHTML = "";
        document.getElementById("convertedStream").innerHTML = "";
      };

      // åˆå§‹åŒ–
      initConverters();

      // ç¦ç”¨æ‰€æœ‰æŒ‰éˆ•ç›´åˆ°åˆå§‹åŒ–å®Œæˆ
      const buttons = document.querySelectorAll("button");
      buttons.forEach((btn) => (btn.disabled = true));
    </script>
  </body>
</html>
