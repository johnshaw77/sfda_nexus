# äºŒæ¬¡ AI èª¿ç”¨çµ±è¨ˆçµæœæ ¼å¼åŒ–ä¿®å¾©ç¸½çµ

## å•é¡Œæè¿°

ç”¨æˆ¶å ±å‘Šåœ¨ä½¿ç”¨ CSV é™„ä»¶é€²è¡Œ `perform_ttest` çµ±è¨ˆåˆ†ææ™‚ï¼Œé›–ç„¶å·¥å…·èª¿ç”¨æˆåŠŸä¸¦è¿”å›äº†å®Œæ•´çš„çµ±è¨ˆçµæœï¼Œä½†äºŒæ¬¡ AI å›æ‡‰å»éŒ¯èª¤åœ°é¡¯ç¤ºã€Œç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æ•¸æ“šå¯ä¾›åˆ†æã€ã€‚

## å•é¡Œåˆ†æ

é€šéæ·±å…¥èª¿æŸ¥ç™¼ç¾äº†å…©å€‹ä¸»è¦å•é¡Œï¼š

### 1. çµ±è¨ˆçµæœæ ¼å¼åŒ–å•é¡Œ
- **åŸå› **ï¼š`McpToolParser.formatToolResults()` æ–¹æ³•å°çµ±è¨ˆåˆ†æå·¥å…·ï¼ˆå¦‚ `perform_ttest`ï¼‰ä½¿ç”¨é€šç”¨çš„ `formatGeneralData()` æ–¹æ³•
- **å½±éŸ¿**ï¼šçµ±è¨ˆçµæœè¢«æ ¼å¼åŒ–ç‚ºæŠ€è¡“æ€§çš„ JSON çµæ§‹ï¼Œä¸åˆ©æ–¼ AI ç†è§£
- **è¡¨ç¾**ï¼šå·¥å…·è¿”å›çš„è±å¯Œçµ±è¨ˆä¿¡æ¯ï¼ˆtå€¼ã€på€¼ã€ç½®ä¿¡å€é–“ç­‰ï¼‰æ²’æœ‰è¢«å‹å¥½åœ°å‘ˆç¾

### 2. ç³»çµ±æç¤ºè©èª¤å°å•é¡Œ
- **åŸå› **ï¼šäºŒæ¬¡ AI èª¿ç”¨çš„ç³»çµ±æç¤ºè©åŒ…å«ã€Œå¦‚æœæŸ¥è©¢çµæœç‚ºç©ºæˆ–æœªæ‰¾åˆ°æ•¸æ“šï¼Œæ˜ç¢ºèªªæ˜ã€ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æ•¸æ“šã€ã€
- **å½±éŸ¿**ï¼šå³ä½¿å·¥å…·çµæœè±å¯Œï¼ŒAI ä¹Ÿå¯èƒ½è¢«èª¤å°èªç‚ºæ²’æœ‰æ•¸æ“š
- **è¡¨ç¾**ï¼šAI å„ªå…ˆéŸ¿æ‡‰ã€Œæ²’æœ‰æ•¸æ“šã€è€Œå¿½ç•¥å¯¦éš›çš„çµ±è¨ˆçµæœ

## ä¿®å¾©æ–¹æ¡ˆ

### 1. çµ±è¨ˆçµæœå°ˆç”¨æ ¼å¼åŒ–å™¨

åœ¨ `backend/src/services/mcpToolParser.service.js` ä¸­æ–°å¢ï¼š

#### çµ±è¨ˆå·¥å…·è­˜åˆ¥æ–¹æ³•
```javascript
isStatisticalTool(toolName) {
  const statisticalTools = [
    'perform_ttest',
    'perform_anova', 
    'perform_chisquare',
    'perform_correlation',
    'analyze_data',
    'descriptive_stats'
  ];
  return statisticalTools.includes(toolName);
}
```

#### çµ±è¨ˆçµæœæ ¼å¼åŒ–æ–¹æ³•
```javascript
formatStatisticalData(data, toolName) {
  // æ ¹æ“šä¸åŒçµ±è¨ˆå·¥å…·é¡å‹é€²è¡Œå°ˆé–€æ ¼å¼åŒ–
  switch (toolName) {
    case 'perform_ttest':
      return this.formatTTestResult(result, data);
    // å…¶ä»–çµ±è¨ˆå·¥å…·...
  }
}
```

#### t æª¢å®šçµæœæ ¼å¼åŒ–
```javascript
formatTTestResult(result, originalData) {
  let formatted = "## ğŸ“Š é…å° t æª¢å®šåˆ†æçµæœ\n\n";
  
  // åŸºæœ¬çµ±è¨ˆé‡
  formatted += "### ğŸ” çµ±è¨ˆé‡\n";
  formatted += `- **t çµ±è¨ˆé‡**: ${Number(result.t_statistic).toFixed(4)}\n`;
  formatted += `- **è‡ªç”±åº¦**: ${result.degrees_of_freedom}\n`;
  formatted += `- **p å€¼**: ${pValue < 0.001 ? 'p < 0.001' : `p = ${pValue.toFixed(4)}`}\n`;
  
  // ç½®ä¿¡å€é–“
  formatted += "### ğŸ“ˆ 95% ç½®ä¿¡å€é–“\n";
  formatted += `- **ç½®ä¿¡å€é–“**: [${ci[0].toFixed(2)}, ${ci[1].toFixed(2)}]\n\n`;
  
  // çµ±è¨ˆæ±ºç­–
  formatted += "### ğŸ¯ çµ±è¨ˆæ±ºç­–\n";
  formatted += `- **çµæœ**: ${isSignificant ? '**çµ±è¨ˆé¡¯è‘—** âœ…' : '**çµ±è¨ˆä¸é¡¯è‘—** âŒ'}\n`;
  
  return formatted;
}
```

### 2. ç³»çµ±æç¤ºè©å„ªåŒ–

åœ¨ `backend/src/services/chat.service.js` ä¸­ä¿®å¾©ï¼š

#### ä¿®å¾©å‰ï¼ˆæœ‰å•é¡Œçš„æç¤ºè©ï¼‰
```javascript
const systemPrompt = `ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„åŠ©ç†ï¼ŒåŸºæ–¼å·¥å…·æŸ¥è©¢çµæœï¼Œç›´æ¥å›ç­”ç”¨æˆ¶çš„å•é¡Œã€‚

é‡è¦è¦å‰‡ï¼š
6. å¦‚æœæŸ¥è©¢çµæœç‚ºç©ºæˆ–æœªæ‰¾åˆ°æ•¸æ“šï¼Œæ˜ç¢ºèªªæ˜ã€Œç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æ•¸æ“šã€  // âŒ èª¤å°æ€§è¦å‰‡
```

#### ä¿®å¾©å¾Œï¼ˆå„ªåŒ–çš„æç¤ºè©ï¼‰
```javascript
const systemPrompt = `ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„æ•¸æ“šåˆ†æåŠ©ç†ï¼ŒåŸºæ–¼å·¥å…·åŸ·è¡Œçµæœï¼Œç”¨è‡ªç„¶èªè¨€å›ç­”ç”¨æˆ¶çš„å•é¡Œã€‚

é‡è¦è¦å‰‡ï¼š
1. ğŸ” **åŸºæ–¼å¯¦éš›çµæœ**ï¼šä¸Šè¿°å·¥å…·åŸ·è¡ŒçµæœåŒ…å«äº†çœŸå¯¦çš„æ•¸æ“šåˆ†æï¼Œè«‹åŸºæ–¼é€™äº›çµæœå›ç­”
2. ğŸ“Š **çµ±è¨ˆçµæœè§£è®€**ï¼šå¦‚æœæ˜¯çµ±è¨ˆåˆ†æï¼Œè«‹ç”¨é€šä¿—æ˜“æ‡‚çš„èªè¨€è§£é‡‹çµ±è¨ˆæ„ç¾©
4. ğŸš« **ç¦æ­¢å…§å®¹**ï¼š
   - ä¸è¦èªªã€Œæ²’æœ‰æ•¸æ“šã€ï¼ˆé™¤éå·¥å…·çœŸçš„å¤±æ•—äº†ï¼‰  // âœ… æ˜ç¢ºç¦æ­¢èª¤å°æ€§å›æ‡‰
```

## ä¿®å¾©æ•ˆæœ

### æ ¼å¼åŒ–å‰ï¼ˆé€šç”¨æ ¼å¼ï¼‰
```
**æŸ¥è©¢çµæœ:**

**data**: [object Object]
**user_friendly_report**: # ğŸ“Š çµ±è¨ˆåˆ†æå ±å‘Š...
```

### æ ¼å¼åŒ–å¾Œï¼ˆçµ±è¨ˆå°ˆç”¨æ ¼å¼ï¼‰
```
## ğŸ“Š é…å° t æª¢å®šåˆ†æçµæœ

### ğŸ” çµ±è¨ˆé‡
- **t çµ±è¨ˆé‡**: -3.2400
- **è‡ªç”±åº¦**: 19
- **p å€¼**: p = 0.0045
- **é¡¯è‘—æ°´æº–**: Î± = 0.05

### ğŸ“ˆ 95% ç½®ä¿¡å€é–“
- **ç½®ä¿¡å€é–“**: [-13.20, -3.80]

### ğŸ¯ çµ±è¨ˆæ±ºç­–
- **çµæœ**: **çµ±è¨ˆé¡¯è‘—** âœ…
- **è§£é‡‹**: åœ¨ Î± = 0.05 çš„é¡¯è‘—æ°´æº–ä¸‹ï¼Œæ‹’çµ•è™›ç„¡å‡è¨­
- **çµè«–**: æ²»ç™‚å‰å¾Œçš„è¡€å£“å­˜åœ¨é¡¯è‘—å·®ç•°
```

## æŠ€è¡“ç‰¹é»

### 1. æ™ºèƒ½è·¯å¾‘è§£æ
- è‡ªå‹•è™•ç†å¤šå±¤åµŒå¥—çš„çµæœçµæ§‹ï¼ˆ`data.data.result`ã€`data.result` ç­‰ï¼‰
- å‘å¾Œå…¼å®¹ç¾æœ‰çš„çµ±è¨ˆå·¥å…·çµæœæ ¼å¼

### 2. å¯æ“´å±•æ¶æ§‹
- æ”¯æŒå¤šç¨®çµ±è¨ˆå·¥å…·ï¼ˆtæª¢å®šã€ANOVAã€å¡æ–¹æª¢å®šç­‰ï¼‰
- æ˜“æ–¼æ·»åŠ æ–°çš„çµ±è¨ˆå·¥å…·æ ¼å¼åŒ–æ”¯æŒ

### 3. éŒ¯èª¤è™•ç†
- æ ¼å¼åŒ–å¤±æ•—æ™‚è‡ªå‹•å›é€€åˆ°é€šç”¨æ ¼å¼
- å®Œæ•´çš„éŒ¯èª¤æ—¥èªŒè¨˜éŒ„

### 4. ç”¨æˆ¶é«”é©—å„ªåŒ–
- çµ±è¨ˆçµæœä»¥ Markdown æ ¼å¼å‘ˆç¾ï¼Œä¾¿æ–¼é–±è®€
- åŒ…å«è¡¨æƒ…ç¬¦è™Ÿå’Œè¦–è¦ºå…ƒç´ ï¼Œæå‡å¯è®€æ€§
- è‡ªå‹•è¨ˆç®—çµ±è¨ˆé¡¯è‘—æ€§ä¸¦æä¾›è§£é‡‹

## æ¸¬è©¦é©—è­‰

å‰µå»ºäº†å®Œæ•´çš„æ¸¬è©¦æµç¨‹ä¾†é©—è­‰ä¿®å¾©æ•ˆæœï¼š

1. **æ ¼å¼åŒ–æ¸¬è©¦**ï¼šé©—è­‰çµ±è¨ˆçµæœæ˜¯å¦æ­£ç¢ºæ ¼å¼åŒ–
2. **ç³»çµ±æç¤ºè©æ¸¬è©¦**ï¼šç¢ºä¿ä¸åŒ…å«èª¤å°æ€§å…§å®¹
3. **ç«¯åˆ°ç«¯æ¸¬è©¦**ï¼šæ¨¡æ“¬å®Œæ•´çš„ç”¨æˆ¶äº¤äº’æµç¨‹

æ¸¬è©¦çµæœé¡¯ç¤ºæ‰€æœ‰æª¢æŸ¥é …ç›®éƒ½é€šéï¼š
- âœ… åŒ…å« t çµ±è¨ˆé‡
- âœ… åŒ…å« p å€¼  
- âœ… åŒ…å«è‡ªç”±åº¦
- âœ… åŒ…å«ç½®ä¿¡å€é–“
- âœ… åŒ…å«çµ±è¨ˆæ±ºç­–
- âœ… æ ¼å¼è‰¯å¥½
- âœ… ä¸æ˜¯é€šç”¨æ ¼å¼

## å½±éŸ¿ç¯„åœ

### ç›´æ¥å½±éŸ¿
- `perform_ttest` å·¥å…·çš„çµæœå±•ç¤º
- äºŒæ¬¡ AI èª¿ç”¨çš„å›æ‡‰è³ªé‡
- çµ±è¨ˆåˆ†æçš„ç”¨æˆ¶é«”é©—

### é–“æ¥å½±éŸ¿
- ç‚ºå…¶ä»–çµ±è¨ˆå·¥å…·ï¼ˆANOVAã€å¡æ–¹æª¢å®šç­‰ï¼‰å¥ å®šäº†æ ¼å¼åŒ–åŸºç¤
- æå‡äº†æ•´é«” AI å•ç­”ç³»çµ±çš„å¯é æ€§
- æ”¹å–„äº†å·¥å…·èª¿ç”¨çµæœçš„å¯è®€æ€§

## å¾ŒçºŒè¨ˆåŠƒ

1. **æ“´å±•æ”¯æŒ**ï¼šç‚ºå…¶ä»–çµ±è¨ˆå·¥å…·æ·»åŠ å°ˆç”¨æ ¼å¼åŒ–å™¨
2. **å‰ç«¯å„ªåŒ–**ï¼šåœ¨å‰ç«¯ä¹Ÿå¯¦ç¾å°æ‡‰çš„çµ±è¨ˆçµæœå±•ç¤ºçµ„ä»¶
3. **æ–‡æª”å®Œå–„**ï¼šæ›´æ–°çµ±è¨ˆå·¥å…·ä½¿ç”¨æŒ‡å—
4. **æ€§èƒ½ç›£æ§**ï¼šè·Ÿè¹¤çµ±è¨ˆåˆ†æçš„æˆåŠŸç‡å’Œç”¨æˆ¶æ»¿æ„åº¦

## çµè«–

é€šéé€™æ¬¡ä¿®å¾©ï¼Œæˆ‘å€‘è§£æ±ºäº†çµ±è¨ˆåˆ†æå·¥å…·åœ¨äºŒæ¬¡ AI èª¿ç”¨ä¸­çš„æ ¸å¿ƒå•é¡Œï¼Œç¢ºä¿äº†ï¼š

1. **æ•¸æ“šå®Œæ•´æ€§**ï¼šçµ±è¨ˆçµæœä¸æœƒä¸Ÿå¤±æˆ–è¢«èª¤è§£
2. **ç”¨æˆ¶é«”é©—**ï¼šAI å›æ‡‰æº–ç¢ºåæ˜ çµ±è¨ˆåˆ†æçµæœ
3. **ç³»çµ±å¯é æ€§**ï¼šé¿å…äº†èª¤å°æ€§çš„ã€Œæ²’æœ‰æ•¸æ“šã€å›æ‡‰
4. **å¯ç¶­è­·æ€§**ï¼šå»ºç«‹äº†å¯æ“´å±•çš„çµ±è¨ˆçµæœè™•ç†æ¶æ§‹

é€™å€‹ä¿®å¾©ä¸åƒ…è§£æ±ºäº†ç•¶å‰å•é¡Œï¼Œé‚„ç‚ºæœªä¾†çš„çµ±è¨ˆåˆ†æåŠŸèƒ½å¥ å®šäº†å …å¯¦åŸºç¤ã€‚ 