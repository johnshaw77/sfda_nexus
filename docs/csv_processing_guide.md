# ğŸ“Š CSV è™•ç†åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

SFDA Nexus ç³»çµ±ç¾å·²æ•´åˆå¼·å¤§çš„ CSV è™•ç†åŠŸèƒ½ï¼Œä½¿ç”¨ qwen3:8b æ¨¡å‹æä¾›å°ˆæ¥­çš„æ•¸æ“šåˆ†æå’Œæ´å¯Ÿã€‚æœ¬åŠŸèƒ½é¡ä¼¼æ–¼ç¾æœ‰çš„åœ–åƒè™•ç†æµç¨‹ï¼Œä½†å°ˆé–€é‡å° CSV æ•¸æ“šé€²è¡Œå„ªåŒ–ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹è‰²

### 1. æ™ºèƒ½ CSV è§£æ

- è‡ªå‹•è™•ç†å¼•è™Ÿå’Œé€—è™Ÿè½‰ç¾©
- æ™ºèƒ½æª¢æ¸¬æ•¸æ“šé¡å‹ï¼ˆæ•¸å­—ã€æ—¥æœŸã€å¸ƒæ—ã€å­—ä¸²ï¼‰
- æ”¯æ´ç¹é«”ä¸­æ–‡å…§å®¹

### 2. å°ˆæ¥­æ•¸æ“šåˆ†æ

- **æ•¸æ“šçµæ§‹åˆ†æ**ï¼šè¡Œæ•¸ã€æ¬„ä½æ•¸ã€æ•¸æ“šé¡å‹æª¢æ¸¬
- **çµ±è¨ˆæ‘˜è¦**ï¼šå¹³å‡å€¼ã€ä¸­ä½æ•¸ã€æ¨™æº–å·®ã€å››åˆ†ä½æ•¸
- **æ•¸æ“šå“è³ªè©•ä¼°**ï¼šç¼ºå¤±å€¼ã€é‡è¤‡å€¼ã€ç•°å¸¸å€¼æª¢æ¸¬
- **å“è³ªè©•åˆ†**ï¼š0-100 åˆ†çš„æ•¸æ“šå“è³ªè©•åˆ†

### 3. AI å¢å¼·æ´å¯Ÿ

- ä½¿ç”¨ qwen3:8b æ¨¡å‹é€²è¡Œæ·±åº¦åˆ†æ
- æ”¯æ´æ€è€ƒæ¨¡å¼ï¼Œæä¾›åˆ†ææ¨ç†éç¨‹
- ç”Ÿæˆæ¥­å‹™æ´å¯Ÿå’Œè™•ç†å»ºè­°
- ç¹é«”ä¸­æ–‡å°ˆæ¥­å ±å‘Š

### 4. æ™ºèƒ½å•ç­”

- åŸºæ–¼ CSV å…§å®¹çš„è‡ªç„¶èªè¨€å•ç­”
- æ”¯æ´è¤‡é›œçš„æ•¸æ“šæŸ¥è©¢
- æä¾›å…·é«”çš„æ•¸æ“šæ”¯æŒ

## ğŸ“‹ API æ¥å£

### 1. æª”æ¡ˆä¸Šå‚³

```http
POST /api/files/upload
Content-Type: multipart/form-data
Authorization: Bearer <token>

Body:
- file: CSV æª”æ¡ˆ
- is_public: false (å¯é¸)
```

### 2. CSV å°ˆæ¥­åˆ†æ

```http
POST /api/files/:id/analyze
Content-Type: application/json
Authorization: Bearer <token>

Body:
{
  "type": "csv_analysis",
  "model": "qwen3:8b"
}
```

### 3. æª”æ¡ˆå•ç­”

```http
POST /api/files/:id/ask
Content-Type: application/json
Authorization: Bearer <token>

Body:
{
  "question": "æ‚¨çš„å•é¡Œ",
  "model": "qwen3:8b"
}
```

## ğŸ“Š åˆ†æçµæœçµæ§‹

### CSV åˆ†æå›æ‡‰æ ¼å¼

```json
{
  "success": true,
  "data": {
    "analysis_type": "csv_professional",
    "csv_data": {
      "filename": "employees.csv",
      "total_rows": 15,
      "total_columns": 6,
      "headers": ["å§“å", "å¹´é½¡", "éƒ¨é–€", "è–ªè³‡", "å…¥è·æ—¥æœŸ", "ç¸¾æ•ˆè©•åˆ†"],
      "sample_rows": [...]
    },
    "data_types": {
      "å§“å": {
        "type": "string",
        "confidence": 1.0,
        "unique_count": 15,
        "null_count": 0
      },
      "å¹´é½¡": {
        "type": "number",
        "confidence": 1.0,
        "unique_count": 12,
        "null_count": 0
      }
    },
    "statistics": {
      "å¹´é½¡": {
        "count": 15,
        "mean": 29.67,
        "median": 29.0,
        "min": 25,
        "max": 36,
        "std": 3.44
      },
      "å§“å": {
        "count": 15,
        "unique_count": 15,
        "avg_length": 2.0
      }
    },
    "quality_report": {
      "missing_values": {},
      "duplicates": {
        "count": 0,
        "percentage": 0
      },
      "outliers": {},
      "summary": {
        "total_issues": 0,
        "quality_score": 100.0
      }
    },
    "ai_insights": {
      "insights": "è©³ç´°çš„ AI åˆ†æå ±å‘Š...",
      "thinking_process": "AI çš„æ€è€ƒéç¨‹...",
      "model_used": "qwen3:8b",
      "processing_time": 2500,
      "generated_at": "2024-01-15T10:30:00.000Z"
    },
    "metadata": {
      "analyzed_at": "2024-01-15T10:30:00.000Z",
      "analysis_version": "1.0.0",
      "sample_size": 15
    },
    "model_used": "qwen3:8b"
  },
  "message": "æª”æ¡ˆCSVåˆ†æå®Œæˆ"
}
```

## ğŸ”§ ä½¿ç”¨ç¯„ä¾‹

### 1. åŸºæœ¬ä½¿ç”¨æµç¨‹

```javascript
// 1. ä¸Šå‚³ CSV æª”æ¡ˆ
const formData = new FormData();
formData.append("file", csvFile);

const uploadResponse = await fetch("/api/files/upload", {
  method: "POST",
  headers: {
    Authorization: `Bearer ${token}`,
  },
  body: formData,
});

const fileData = await uploadResponse.json();
const fileId = fileData.data.id;

// 2. é€²è¡Œ CSV åˆ†æ
const analysisResponse = await fetch(`/api/files/${fileId}/analyze`, {
  method: "POST",
  headers: {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    type: "csv_analysis",
    model: "qwen3:8b",
  }),
});

const analysis = await analysisResponse.json();

// 3. æª”æ¡ˆå•ç­”
const qaResponse = await fetch(`/api/files/${fileId}/ask`, {
  method: "POST",
  headers: {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    question: "å“ªå€‹éƒ¨é–€çš„å¹³å‡è–ªè³‡æœ€é«˜ï¼Ÿ",
    model: "qwen3:8b",
  }),
});

const answer = await qaResponse.json();
```

### 2. æ¸¬è©¦è…³æœ¬ä½¿ç”¨

```bash
# é€²å…¥å¾Œç«¯ç›®éŒ„
cd backend

# åŸ·è¡Œæ¸¬è©¦è…³æœ¬
node database/scripts/test_csv_processing.js
```

## ğŸ“ˆ åˆ†æèƒ½åŠ›

### æ”¯æ´çš„æ•¸æ“šé¡å‹

- **æ•¸å­— (number)**ï¼šæ•´æ•¸ã€å°æ•¸ã€ç§‘å­¸è¨˜è™Ÿ
- **æ—¥æœŸ (date)**ï¼šå„ç¨®æ—¥æœŸæ ¼å¼
- **å¸ƒæ— (boolean)**ï¼štrue/false, 1/0, yes/no
- **å­—ä¸² (string)**ï¼šæ–‡æœ¬å…§å®¹
- **ç©ºå€¼ (empty)**ï¼šå®Œå…¨ç©ºç™½çš„æ¬„ä½

### çµ±è¨ˆåˆ†æåŠŸèƒ½

- **æ•¸å€¼æ¬„ä½**ï¼šå¹³å‡å€¼ã€ä¸­ä½æ•¸ã€æœ€å°å€¼ã€æœ€å¤§å€¼ã€æ¨™æº–å·®ã€å››åˆ†ä½æ•¸
- **æ–‡å­—æ¬„ä½**ï¼šå”¯ä¸€å€¼æ•¸é‡ã€æœ€å¸¸è¦‹å€¼ã€å¹³å‡é•·åº¦
- **å“è³ªæª¢æ¸¬**ï¼šç¼ºå¤±å€¼æ¯”ä¾‹ã€é‡è¤‡è¡Œæª¢æ¸¬ã€ç•°å¸¸å€¼è­˜åˆ¥

### AI æ´å¯Ÿå…§å®¹

1. **æ•¸æ“šæ¦‚æ³ç¸½çµ**ï¼šæ•¸æ“šé›†ç‰¹å¾µå’Œç”¨é€”æè¿°
2. **é—œéµç™¼ç¾**ï¼šæ•¸æ“šåˆ†ä½ˆç‰¹å¾µå’Œçµ±è¨ˆæŒ‡æ¨™
3. **æ•¸æ“šå“è³ªè©•ä¼°**ï¼šå•é¡Œè­˜åˆ¥å’Œæ”¹å–„å»ºè­°
4. **æ¥­å‹™æ´å¯Ÿ**ï¼šè¶¨å‹¢åˆ†æå’Œå•†æ¥­åƒ¹å€¼
5. **æ•¸æ“šè™•ç†å»ºè­°**ï¼šæ¸…ç†æ­¥é©Ÿå’Œåˆ†ææ–¹æ³•

## âš™ï¸ é…ç½®é¸é …

### æ¨¡å‹é…ç½®

- **é è¨­æ¨¡å‹**ï¼šqwen3:8b
- **æ€è€ƒæ¨¡å¼**ï¼šè‡ªå‹•å•Ÿç”¨ï¼ˆæ”¯æ´çš„æ¨¡å‹ï¼‰
- **æº«åº¦è¨­å®š**ï¼š0.3ï¼ˆç¢ºä¿åˆ†æä¸€è‡´æ€§ï¼‰
- **æœ€å¤§ tokens**ï¼š4096

### è™•ç†é™åˆ¶

- **æœ€å¤§è¡Œæ•¸**ï¼š5000 è¡Œï¼ˆå¯é…ç½®ï¼‰
- **æª”æ¡ˆå¤§å°**ï¼š10MBï¼ˆç¹¼æ‰¿æª”æ¡ˆä¸Šå‚³é™åˆ¶ï¼‰
- **è¶…æ™‚è¨­å®š**ï¼š5 åˆ†é˜

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **CSV è§£æå¤±æ•—**

   - æª¢æŸ¥æª”æ¡ˆç·¨ç¢¼ï¼ˆå»ºè­° UTF-8ï¼‰
   - ç¢ºèª CSV æ ¼å¼æ­£ç¢º
   - æª¢æŸ¥æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦

2. **AI åˆ†æå¤±æ•—**

   - ç¢ºèª Ollama æœå‹™é‹è¡Œ
   - æª¢æŸ¥ qwen3:8b æ¨¡å‹æ˜¯å¦å®‰è£
   - æŸ¥çœ‹å¾Œç«¯æ—¥èªŒéŒ¯èª¤ä¿¡æ¯

3. **åˆ†æçµæœä¸æº–ç¢º**
   - æª¢æŸ¥æ•¸æ“šå“è³ªåˆ†æ•¸
   - ç¢ºèªæ•¸æ“šé¡å‹æª¢æ¸¬æ­£ç¢º
   - è€ƒæ…®æ•¸æ“šé è™•ç†

### é™ç´šæ©Ÿåˆ¶

- AI æœå‹™ä¸å¯ç”¨æ™‚è‡ªå‹•é™ç´šåˆ°åŸºæœ¬çµ±è¨ˆåˆ†æ
- æä¾›åŸºæœ¬çš„çµæ§‹ä¿¡æ¯å’ŒéŒ¯èª¤æç¤º
- ä¿è­‰ç³»çµ±ç©©å®šæ€§

## ğŸ”® æœªä¾†æ“´å±•

### è¨ˆåŠƒåŠŸèƒ½

- æ”¯æ´æ›´å¤šæª”æ¡ˆæ ¼å¼ï¼ˆExcelã€JSONï¼‰
- æ•¸æ“šè¦–è¦ºåŒ–ç”Ÿæˆ
- è‡ªå‹•åŒ–å ±å‘Šç”Ÿæˆ
- æ‰¹é‡æª”æ¡ˆè™•ç†
- æ•¸æ“šæ¸…ç†å»ºè­°åŸ·è¡Œ

### æ¨¡å‹æ”¯æ´

- æ”¯æ´æ›´å¤š AI æ¨¡å‹
- å°ˆé–€çš„æ•¸æ“šåˆ†ææ¨¡å‹
- å¤šèªè¨€æ”¯æ´

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹è¯ç¹«é–‹ç™¼åœ˜éšŠæˆ–æŸ¥çœ‹ç³»çµ±æ—¥èªŒç²å–è©³ç´°éŒ¯èª¤ä¿¡æ¯ã€‚

---

_æœ¬æ–‡æª”éš¨ç³»çµ±æ›´æ–°è€Œæ›´æ–°ï¼Œè«‹é—œæ³¨æœ€æ–°ç‰ˆæœ¬ã€‚_
