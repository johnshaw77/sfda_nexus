# SFDA Nexus 知識庫管理功能規劃

## 📋 功能概述
在 SFDA Nexus 管理後台增加「知識庫管理」選單，提供 KESS 知識庫的查看和管理功能，為未來的 MCP 服務做準備。

## 🎯 專案背景
- **源系統**: SFDA KESS (Knowledge Extraction and Summary System)
- **目標**: 整合 KESS 知識庫到 Nexus 管理界面
- **未來規劃**: 開發為 MCP 服務，供 AI 智能體調用

## 🏗️ 系統架構設計

### 1. 後端 API 層
```
backend/src/
├── routes/
│   └── knowledge.route.js        # 知識庫路由
├── controllers/
│   └── knowledge.controller.js   # 知識庫控制器
├── models/
│   └── Knowledge.model.js        # 知識庫模型
└── services/
    └── knowledge.service.js      # 知識庫服務層
```

### 2. 前端頁面層
```
frontend/src/
├── views/admin/
│   └── knowledge/
│       ├── index.vue            # 主頁面（二欄布局）
│       ├── CategoryTree.vue     # 左側分類樹
│       ├── SummaryList.vue      # 摘要列表
│       ├── SummaryDetail.vue    # 摘要詳情
│       └── DocumentDetail.vue   # 文件詳情
├── api/
│   └── knowledge.js             # 知識庫 API
└── stores/
    └── knowledge.js             # 知識庫狀態管理
```

## 📱 頁面流程設計

### 主頁面布局（二欄設計）
```
┌─────────────────────────────────────────────────────────┐
│                    知識庫管理                            │
├─────────────────────────────────────────────────────────┤
│ 左側樹狀目錄 (30%)     │      右側內容區域 (70%)         │
│                       │                                │
│ 📁 製造部門 (MFG)      │  ┌─ 搜索欄 ─────────────────┐   │
│   📄 文件分類1         │  │                          │   │
│   📄 文件分類2         │  └──────────────────────────┘   │
│ 📁 品保部門 (QA)       │                                │
│   📄 文件分類1         │  ┌─ 內容顯示區域 ─────────────┐   │
│ 📁 資訊部門 (IT)       │  │                          │   │
│   📄 文件分類1         │  │ • 摘要列表                │   │
│ 📁 人資部門 (HR)       │  │ • 摘要詳情                │   │
│   📄 文件分類1         │  │ • 文件詳情                │   │
│ 📁 財務部門 (FIN)      │  │                          │   │
│ 📁 研發部門 (R&D)      │  └──────────────────────────┘   │
│ 📁 行政部門 (ADMIN)    │                                │
└─────────────────────────────────────────────────────────┘
```

### 導航流程
**三層導航結構**: 分類樹 → 摘要列表 → 摘要詳情 → 文件詳情

1. **第一層**: 點擊分類樹節點，顯示該分類下的 AI 摘要列表
2. **第二層**: 點擊摘要項目，顯示摘要詳細內容
3. **第三層**: 點擊「查看原文件」，顯示原始文件詳情

## 🛠️ 技術實現細節

### 1. 後端 API 設計
```javascript
// knowledge.route.js - API 端點設計
GET    /api/knowledge/categories          // 獲取分類樹
GET    /api/knowledge/summaries/:categoryId // 獲取分類下的摘要列表
GET    /api/knowledge/summary/:id         // 獲取摘要詳情
GET    /api/knowledge/document/:id        // 獲取文件詳情
POST   /api/knowledge/search              // 搜索功能
PUT    /api/knowledge/summary/:id         // 更新摘要
DELETE /api/knowledge/summary/:id         // 刪除摘要
GET    /api/knowledge/stats               // 統計信息
```

### 2. 資料庫查詢邏輯
```sql
-- 分類樹查詢
SELECT id, category_code, category_name, description, 
       (SELECT COUNT(*) FROM kess_summaries WHERE category_id = kess_categories.id) as summary_count
FROM kess_categories 
WHERE is_active = 1 
ORDER BY sort_order;

-- 摘要列表查詢
SELECT s.id, s.title, s.summary_type, s.key_points, s.keywords, 
       s.created_at, d.file_name, d.file_size
FROM kess_summaries s
JOIN kess_documents d ON s.document_id = d.id
WHERE s.category_id = ? 
ORDER BY s.created_at DESC;

-- 摘要詳情查詢
SELECT s.*, d.file_name, d.file_path, d.file_size, d.file_extension,
       d.created_at as document_created_at
FROM kess_summaries s
JOIN kess_documents d ON s.document_id = d.id
WHERE s.id = ?;
```

### 3. 前端狀態管理
```javascript
// stores/knowledge.js
export const useKnowledgeStore = defineStore('knowledge', {
  state: () => ({
    categories: [],
    selectedCategory: null,
    summaries: [],
    selectedSummary: null,
    documentDetail: null,
    loading: false,
    searchQuery: '',
    pagination: {
      current: 1,
      pageSize: 20,
      total: 0
    }
  }),
  
  actions: {
    async fetchCategories(),
    async fetchSummaries(categoryId, page = 1),
    async fetchSummaryDetail(summaryId),
    async fetchDocumentDetail(documentId),
    async searchSummaries(query)
  }
})
```

## 🎨 UI/UX 設計規範

### 響應式設計
- **桌面端** (≥1200px): 左側樹狀目錄固定寬度 30%，右側內容區域 70%
- **平板端** (768px-1199px): 左側可折疊，右側全寬顯示
- **手機端** (<768px): 抽屜式側邊欄，全屏內容顯示

### 交互設計
- **樹狀目錄**: 支援展開/折疊，顯示文件數量徽章
- **摘要列表**: 分頁加載，支援搜索和篩選
- **詳情頁面**: 支援返回導航，面包屑路徑
- **操作按鈕**: 編輯、刪除、下載等功能

### 視覺設計
- **圖標系統**: 使用 Ant Design 圖標庫
- **顏色方案**: 遵循 Nexus 主題色彩
- **字體排版**: 中文優化的字體設置
- **暗黑模式**: 完整支援暗黑主題

## 🔧 開發實施步驟

### Phase 1: 後端 API 開發
- [x] 規劃設計完成
- [x] 建立知識庫模型和服務層
- [x] 實現分類樹和摘要列表 API
- [x] 實現搜索和詳情查詢 API
- [x] 添加路由到主路由文件
- [x] API 基礎測試完成
- [ ] 完整 API 測試和文檔

### Phase 2: 前端頁面開發
- [ ] 建立知識庫狀態管理
- [ ] 開發主頁面二欄布局
- [ ] 實現分類樹組件
- [ ] 開發摘要列表和詳情組件
- [ ] 整合到管理後台選單

### Phase 3: 整合和優化
- [ ] 實現響應式設計
- [ ] 添加搜索和篩選功能
- [ ] 性能優化和錯誤處理
- [ ] 用戶體驗優化

### Phase 4: MCP 服務準備
- [ ] 標準化 API 接口
- [ ] 實現權限控制
- [ ] 添加快取機制
- [ ] MCP 工具開發

## 📊 資料結構映射

### KESS 資料庫表格對應
- `kess_categories` → 分類樹節點
- `kess_summaries` → AI 摘要數據
- `kess_documents` → 原始文件信息
- `kess_entities` → 實體識別結果
- `kess_keywords` → 關鍵字提取結果

### API 響應格式
```json
{
  "success": true,
  "data": {
    "categories": [...],
    "summaries": [...],
    "pagination": {...}
  },
  "message": "操作成功",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

## 🔒 安全性考慮

### 權限控制
- **管理員權限**: 完整的查看、編輯、刪除權限
- **一般用戶**: 僅查看權限
- **API 權限**: 基於 JWT Token 驗證

### 數據安全
- **敏感信息過濾**: 避免洩露文件路徑等敏感信息
- **SQL 注入防護**: 使用參數化查詢
- **XSS 防護**: 前端數據清理和轉義

## 🚀 未來擴展

### MCP 服務功能
- **知識檢索**: 支援語義搜索和關鍵字搜索
- **摘要生成**: 為新文件自動生成摘要
- **知識問答**: 基於知識庫的智能問答
- **文件分析**: 文件內容分析和分類

### 高級功能
- **知識圖譜**: 構建實體關係圖
- **智能推薦**: 相關文件推薦
- **版本控制**: 摘要版本管理
- **協作功能**: 多人協作編輯摘要

## 📈 性能指標

### 目標指標
- **頁面載入時間**: < 2 秒
- **API 響應時間**: < 500ms
- **搜索響應時間**: < 1 秒
- **並發用戶**: 支援 100+ 並發

### 優化策略
- **資料庫索引**: 優化查詢性能
- **前端快取**: 減少重複請求
- **分頁加載**: 避免大量數據載入
- **CDN 加速**: 靜態資源加速

---

**文檔版本**: v1.0  
**創建日期**: 2024-01-01  
**最後更新**: 2024-01-01  
**負責人**: AI Assistant 