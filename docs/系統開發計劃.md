# sfda_nexus ä¼æ¥­ AI èŠå¤©ç³»çµ±é–‹ç™¼è¨ˆåŠƒ

## ğŸ“‹ é …ç›®æ¦‚è¿°

**é …ç›®åç¨±**: sfda_nexus  
**é …ç›®é¡å‹**: ä¼æ¥­å…§éƒ¨ AI èŠå¤©ç³»çµ±  
**é–‹ç™¼æ¨¡å¼**: çµ±ä¸€ç®¡ç†ï¼Œç”¨æˆ¶ä½¿ç”¨  
**æŠ€è¡“æ£§**: Vue 3 + Ant Design + Node.js + Express + MySQL

---

## ğŸ¯ ç³»çµ±å®šä½

- ğŸ¢ **ä¼æ¥­å…§éƒ¨ AI æœå‹™å¹³å°**
- ğŸ‘¥ **ç®¡ç†å“¡çµ±ä¸€é…ç½®ï¼Œå“¡å·¥ç›´æ¥ä½¿ç”¨**
- ğŸ¤– **é è¨­æ™ºèƒ½é«”è§’è‰²ï¼Œæ¨™æº–åŒ–æœå‹™**
- ğŸ“‹ **å·¥ä½œæµç¨‹è‡ªå‹•åŒ–**
- ğŸ”’ **æ¬Šé™æ§åˆ¶èˆ‡å¯©è¨ˆ**

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### **å‰ç«¯æŠ€è¡“æ£§**

- **æ¡†æ¶**: Vue 3 (Composition API)
- **UI åº«**: Ant Design Vue 4.x
- **ç‹€æ…‹ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router 4
- **HTTP å®¢æˆ¶ç«¯**: Axios
- **å¯¦æ™‚é€šä¿¡**: WebSocket
- **èªè¨€**: ç´” JavaScript

### **å¾Œç«¯æŠ€è¡“æ£§**

- **æ¡†æ¶**: Node.js + Express.js
- **è³‡æ–™åº«**: MySQL 8.0
- **ORM**: åŸç”Ÿ SQL (mysql2)
- **èªè­‰**: JWT
- **æª”æ¡ˆä¸Šå‚³**: Multer
- **API æ–‡æª”**: Swagger
- **å¯¦æ™‚é€šä¿¡**: WebSocket (ws)
- **èªè¨€**: ç´” JavaScript

### **AI æ•´åˆ**

- **æœ¬åœ°æ¨¡å‹**: Ollama (ä¸»è¦)
- **é›²ç«¯æœå‹™**: Google Gemini (è¼”åŠ©)
- **å‘é‡è³‡æ–™åº«**: Qdrant (çŸ¥è­˜åº«)
- **å·¥å…·å”è­°**: MCP (Model Context Protocol)

---

## ğŸ“ å‰ç«¯ç›®éŒ„çµæ§‹

```
frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ views/                          # é é¢è¦–åœ–
â”‚   â”‚   â”œâ”€â”€ auth/                       # èªè­‰ç›¸é—œé é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue              # ç™»å…¥é é¢
â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚       â”œâ”€â”€ LoginForm.vue
â”‚   â”‚   â”‚       â””â”€â”€ RegisterForm.vue
â”‚   â”‚   â”œâ”€â”€ chat/                       # èŠå¤©åŠŸèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue              # ä¸»èŠå¤©é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ history.vue            # å°è©±æ­·å²
â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚       â”œâ”€â”€ ChatWindow.vue     # èŠå¤©è¦–çª—
â”‚   â”‚   â”‚       â”œâ”€â”€ MessageItem.vue    # è¨Šæ¯é …ç›®
â”‚   â”‚   â”‚       â”œâ”€â”€ FileUpload.vue     # æª”æ¡ˆä¸Šå‚³
â”‚   â”‚   â”‚       â”œâ”€â”€ ModelSelector.vue  # æ¨¡å‹é¸æ“‡å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ AgentSelector.vue  # æ™ºèƒ½é«”é¸æ“‡å™¨
â”‚   â”‚   â”‚       â””â”€â”€ PromptTemplates.vue # å‘½ä»¤è©æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ admin/                      # ç®¡ç†åŠŸèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.vue          # ç®¡ç†å„€è¡¨æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ models/                # æ¨¡å‹ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ModelList.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ModelForm.vue
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ModelTest.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ agents/                # æ™ºèƒ½é«”ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AgentList.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AgentForm.vue
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ AgentPreview.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ workflows/             # å·¥ä½œæµç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ WorkflowList.vue
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ WorkflowDesigner.vue
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ExecutionLog.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ users/                 # ç”¨æˆ¶ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.vue
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ UserList.vue
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ UserForm.vue
â”‚   â”‚   â”‚   â””â”€â”€ system/                # ç³»çµ±ç›£æ§
â”‚   â”‚   â”‚       â”œâ”€â”€ index.vue
â”‚   â”‚   â”‚       â””â”€â”€ components/
â”‚   â”‚   â”‚           â”œâ”€â”€ SystemStats.vue
â”‚   â”‚   â”‚           â”œâ”€â”€ UsageChart.vue
â”‚   â”‚   â”‚           â””â”€â”€ AuditLog.vue
â”‚   â”‚   â””â”€â”€ user/                       # ç”¨æˆ¶å€‹äººåŠŸèƒ½
â”‚   â”‚       â”œâ”€â”€ profile.vue            # å€‹äººè³‡æ–™
â”‚   â”‚       â””â”€â”€ components/
â”‚   â”‚           â””â”€â”€ ProfileForm.vue
â”‚   â”œâ”€â”€ components/                     # å…±ç”¨çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ AppLayout.vue          # ä¸»ä½ˆå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.vue            # å´é‚Šæ¬„
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.vue             # é ‚éƒ¨å°èˆª
â”‚   â”‚   â”‚   â””â”€â”€ Footer.vue             # åº•éƒ¨
â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â”œâ”€â”€ Loading.vue            # è¼‰å…¥çµ„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Empty.vue              # ç©ºç‹€æ…‹
â”‚   â”‚   â”‚   â”œâ”€â”€ ErrorBoundary.vue      # éŒ¯èª¤é‚Šç•Œ
â”‚   â”‚   â”‚   â””â”€â”€ ConfirmDialog.vue      # ç¢ºèªå°è©±æ¡†
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â”œâ”€â”€ IconButton.vue         # åœ–æ¨™æŒ‰éˆ•
â”‚   â”‚       â”œâ”€â”€ StatusTag.vue          # ç‹€æ…‹æ¨™ç±¤
â”‚   â”‚       â””â”€â”€ DataTable.vue          # æ•¸æ“šè¡¨æ ¼
â”‚   â”œâ”€â”€ stores/                         # ç‹€æ…‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth.js                    # èªè­‰ç‹€æ…‹
â”‚   â”‚   â”œâ”€â”€ chat.js                    # èŠå¤©ç‹€æ…‹
â”‚   â”‚   â”œâ”€â”€ models.js                  # æ¨¡å‹ç‹€æ…‹
â”‚   â”‚   â”œâ”€â”€ agents.js                  # æ™ºèƒ½é«”ç‹€æ…‹
â”‚   â”‚   â”œâ”€â”€ workflows.js               # å·¥ä½œæµç‹€æ…‹
â”‚   â”‚   â””â”€â”€ app.js                     # æ‡‰ç”¨å…¨å±€ç‹€æ…‹
â”‚   â”œâ”€â”€ utils/                          # å·¥å…·å‡½æ•¸
â”‚   â”‚   â”œâ”€â”€ api.js                     # API èª¿ç”¨
â”‚   â”‚   â”œâ”€â”€ websocket.js               # WebSocket é€£æ¥
â”‚   â”‚   â”œâ”€â”€ auth.js                    # èªè­‰å·¥å…·
â”‚   â”‚   â”œâ”€â”€ format.js                  # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚   â”œâ”€â”€ validation.js              # é©—è­‰å·¥å…·
â”‚   â”‚   â””â”€â”€ constants.js               # å¸¸é‡å®šç¾©
â”‚   â”œâ”€â”€ router/                         # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ styles/                         # æ¨£å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ main.css
â”‚   â”‚   â”œâ”€â”€ variables.css
â”‚   â”‚   â””â”€â”€ components.css
â”‚   â”œâ”€â”€ App.vue                        # æ ¹çµ„ä»¶
â”‚   â””â”€â”€ main.js                        # å…¥å£æ–‡ä»¶
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â””â”€â”€ README.md
```

---

## ğŸ“ å¾Œç«¯ç›®éŒ„çµæ§‹

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/                    # æ§åˆ¶å™¨å±¤
â”‚   â”‚   â”œâ”€â”€ authController.js          # èªè­‰æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ chatController.js          # èŠå¤©æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ modelController.js         # æ¨¡å‹æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ agentController.js         # æ™ºèƒ½é«”æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ workflowController.js      # å·¥ä½œæµæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ userController.js          # ç”¨æˆ¶æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ toolController.js          # å·¥å…·æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ adminController.js         # ç®¡ç†æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ routes/                         # è·¯ç”±å±¤
â”‚   â”‚   â”œâ”€â”€ auth.js                    # èªè­‰è·¯ç”± + Swagger
â”‚   â”‚   â”œâ”€â”€ chat.js                    # èŠå¤©è·¯ç”± + Swagger
â”‚   â”‚   â”œâ”€â”€ models.js                  # æ¨¡å‹è·¯ç”± + Swagger
â”‚   â”‚   â”œâ”€â”€ agents.js                  # æ™ºèƒ½é«”è·¯ç”± + Swagger
â”‚   â”‚   â”œâ”€â”€ workflows.js               # å·¥ä½œæµè·¯ç”± + Swagger
â”‚   â”‚   â”œâ”€â”€ users.js                   # ç”¨æˆ¶è·¯ç”± + Swagger
â”‚   â”‚   â”œâ”€â”€ tools.js                   # å·¥å…·è·¯ç”± + Swagger
â”‚   â”‚   â”œâ”€â”€ admin.js                   # ç®¡ç†è·¯ç”± + Swagger
â”‚   â”‚   â””â”€â”€ index.js                   # è·¯ç”±åŒ¯ç¸½
â”‚   â”œâ”€â”€ services/                       # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”‚   â”œâ”€â”€ aiService.js               # AIæ¨¡å‹æœå‹™
â”‚   â”‚   â”œâ”€â”€ chatService.js             # èŠå¤©æœå‹™
â”‚   â”‚   â”œâ”€â”€ agentService.js            # æ™ºèƒ½é«”æœå‹™
â”‚   â”‚   â”œâ”€â”€ workflowService.js         # å·¥ä½œæµæœå‹™
â”‚   â”‚   â”œâ”€â”€ knowledgeService.js        # çŸ¥è­˜åº«æœå‹™
â”‚   â”‚   â”œâ”€â”€ mcpService.js              # MCPå·¥å…·æœå‹™
â”‚   â”‚   â””â”€â”€ notificationService.js     # é€šçŸ¥æœå‹™
â”‚   â”œâ”€â”€ models/                         # æ•¸æ“šæ¨¡å‹å±¤
â”‚   â”‚   â”œâ”€â”€ User.js                    # ç”¨æˆ¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Conversation.js            # å°è©±æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Message.js                 # è¨Šæ¯æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Agent.js                   # æ™ºèƒ½é«”æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ AIModel.js                 # AIæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Workflow.js                # å·¥ä½œæµæ¨¡å‹
â”‚   â”‚   â””â”€â”€ index.js                   # æ¨¡å‹åŒ¯ç¸½
â”‚   â”œâ”€â”€ middleware/                     # ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.js                    # èªè­‰ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ admin.js                   # ç®¡ç†å“¡æ¬Šé™ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ validation.js              # æ•¸æ“šé©—è­‰ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ rateLimit.js               # é™æµä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ logger.js                  # æ—¥èªŒä¸­é–“ä»¶
â”‚   â”‚   â””â”€â”€ errorHandler.js            # éŒ¯èª¤è™•ç†ä¸­é–“ä»¶
â”‚   â”œâ”€â”€ utils/                          # å·¥å…·å‡½æ•¸
â”‚   â”‚   â”œâ”€â”€ database.js                # è³‡æ–™åº«é€£æ¥
â”‚   â”‚   â”œâ”€â”€ encryption.js              # åŠ å¯†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ jwt.js                     # JWTå·¥å…·
â”‚   â”‚   â”œâ”€â”€ fileHandler.js             # æª”æ¡ˆè™•ç†
â”‚   â”‚   â”œâ”€â”€ logger.js                  # æ—¥èªŒå·¥å…·
â”‚   â”‚   â””â”€â”€ validator.js               # é©—è­‰å·¥å…·
â”‚   â”œâ”€â”€ config/                         # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.js                # è³‡æ–™åº«é…ç½®
â”‚   â”‚   â”œâ”€â”€ swagger.js                 # Swaggeré…ç½®
â”‚   â”‚   â”œâ”€â”€ cors.js                    # CORSé…ç½®
â”‚   â”‚   â””â”€â”€ index.js                   # é…ç½®åŒ¯ç¸½
â”‚   â”œâ”€â”€ docs/                           # APIæ–‡æª”
â”‚   â”‚   â”œâ”€â”€ swagger/                   # Swaggerå®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ models.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ agents.yaml
â”‚   â”‚   â”‚   â””â”€â”€ workflows.yaml
â”‚   â”‚   â””â”€â”€ schemas/                   # æ•¸æ“šæ¨¡å¼å®šç¾©
â”‚   â”‚       â”œâ”€â”€ user.yaml
â”‚   â”‚       â”œâ”€â”€ message.yaml
â”‚   â”‚       â””â”€â”€ agent.yaml
â”‚   â””â”€â”€ websocket/                      # WebSocketè™•ç†
â”‚       â”œâ”€â”€ chatHandler.js             # èŠå¤©WebSocket
â”‚       â”œâ”€â”€ notificationHandler.js     # é€šçŸ¥WebSocket
â”‚       â””â”€â”€ index.js                   # WebSocketåŒ¯ç¸½
â”œâ”€â”€ database/                           # è³‡æ–™åº«ç›¸é—œ
â”‚   â”œâ”€â”€ migrations/                    # è³‡æ–™åº«é·ç§»
â”‚   â”‚   â”œâ”€â”€ 001_create_users_table.sql
â”‚   â”‚   â”œâ”€â”€ 002_create_models_table.sql
â”‚   â”‚   â”œâ”€â”€ 003_create_agents_table.sql
â”‚   â”‚   â”œâ”€â”€ 004_create_conversations_table.sql
â”‚   â”‚   â”œâ”€â”€ 005_create_messages_table.sql
â”‚   â”‚   â””â”€â”€ 006_create_workflows_table.sql
â”‚   â”œâ”€â”€ seeds/                         # åˆå§‹æ•¸æ“š
â”‚   â”‚   â”œâ”€â”€ default_models.sql
â”‚   â”‚   â”œâ”€â”€ default_agents.sql
â”‚   â”‚   â””â”€â”€ admin_user.sql
â”‚   â””â”€â”€ schema.sql                     # å®Œæ•´è³‡æ–™åº«çµæ§‹
â”œâ”€â”€ uploads/                            # æª”æ¡ˆä¸Šå‚³ç›®éŒ„
â”‚   â”œâ”€â”€ avatars/                       # é ­åƒ
â”‚   â”œâ”€â”€ attachments/                   # èŠå¤©é™„ä»¶
â”‚   â””â”€â”€ documents/                     # æ–‡æª”
â”œâ”€â”€ logs/                               # æ—¥èªŒç›®éŒ„
â”‚   â”œâ”€â”€ access.log                     # è¨ªå•æ—¥èªŒ
â”‚   â”œâ”€â”€ error.log                      # éŒ¯èª¤æ—¥èªŒ
â”‚   â””â”€â”€ audit.log                      # å¯©è¨ˆæ—¥èªŒ
â”œâ”€â”€ tests/                              # æ¸¬è©¦æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/                          # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ integration/                   # æ•´åˆæ¸¬è©¦
â”‚   â””â”€â”€ fixtures/                      # æ¸¬è©¦æ•¸æ“š
â”œâ”€â”€ server.js                          # æœå‹™å™¨å…¥å£
â”œâ”€â”€ package.json
â”œâ”€â”€ .env.example                       # ç’°å¢ƒè®Šé‡ç¯„ä¾‹
â”œâ”€â”€ docker-compose.yml                 # Dockeré…ç½®
â”œâ”€â”€ Dockerfile
â””â”€â”€ README.md
```

---

## ğŸ—„ï¸ è³‡æ–™åº«è¨­è¨ˆ

### **æ ¸å¿ƒè¡¨çµæ§‹**

```sql
-- ç”¨æˆ¶è¡¨
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role ENUM('user', 'admin') DEFAULT 'user',
    department VARCHAR(100),
    avatar_url VARCHAR(500),
    is_active BOOLEAN DEFAULT TRUE,
    last_login_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_role (role)
);

-- AIæ¨¡å‹è¡¨
CREATE TABLE ai_models (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    model_type ENUM('ollama', 'gemini') NOT NULL,
    model_id VARCHAR(200) NOT NULL,
    endpoint_url VARCHAR(500),
    api_key TEXT, -- åŠ å¯†å­˜å„²
    parameters JSON,
    capabilities JSON,
    is_active BOOLEAN DEFAULT TRUE,
    is_multimodal BOOLEAN DEFAULT FALSE,
    max_tokens INT DEFAULT 4096,
    cost_per_1k_tokens DECIMAL(10,6) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_model_type (model_type),
    INDEX idx_is_active (is_active)
);

-- æ™ºèƒ½é«”è¡¨
CREATE TABLE agents (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    description TEXT,
    avatar_url VARCHAR(500),
    system_prompt TEXT NOT NULL,
    model_id INT NOT NULL,
    parameters JSON,
    capabilities JSON,
    is_active BOOLEAN DEFAULT TRUE,
    usage_count INT DEFAULT 0,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (model_id) REFERENCES ai_models(id),
    FOREIGN KEY (created_by) REFERENCES users(id),
    INDEX idx_is_active (is_active),
    INDEX idx_model_id (model_id)
);

-- å°è©±è¡¨
CREATE TABLE conversations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    agent_id INT NULL,
    model_id INT NOT NULL,
    title VARCHAR(200),
    is_active BOOLEAN DEFAULT TRUE,
    message_count INT DEFAULT 0,
    total_tokens INT DEFAULT 0,
    total_cost DECIMAL(10,6) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (agent_id) REFERENCES agents(id),
    FOREIGN KEY (model_id) REFERENCES ai_models(id),
    INDEX idx_user_id (user_id),
    INDEX idx_agent_id (agent_id),
    INDEX idx_created_at (created_at)
);

-- è¨Šæ¯è¡¨
CREATE TABLE messages (
    id INT AUTO_INCREMENT PRIMARY KEY,
    conversation_id INT NOT NULL,
    role ENUM('user', 'assistant', 'system') NOT NULL,
    content TEXT NOT NULL,
    attachments JSON,
    tokens_used INT DEFAULT 0,
    cost DECIMAL(10,6) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE,
    INDEX idx_conversation_id (conversation_id),
    INDEX idx_created_at (created_at)
);

-- å‘½ä»¤è©æ¨¡æ¿è¡¨
CREATE TABLE prompt_templates (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    category VARCHAR(50),
    template TEXT NOT NULL,
    variables JSON,
    is_active BOOLEAN DEFAULT TRUE,
    usage_count INT DEFAULT 0,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id),
    INDEX idx_category (category),
    INDEX idx_is_active (is_active)
);

-- MCPå·¥å…·è¡¨
CREATE TABLE mcp_tools (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    description TEXT,
    tool_type VARCHAR(50),
    config JSON,
    is_active BOOLEAN DEFAULT TRUE,
    usage_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_tool_type (tool_type),
    INDEX idx_is_active (is_active)
);

-- å·¥ä½œæµè¡¨
CREATE TABLE workflows (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    description TEXT,
    definition JSON,
    trigger_type ENUM('manual', 'scheduled', 'event') DEFAULT 'manual',
    schedule_config JSON,
    is_active BOOLEAN DEFAULT TRUE,
    execution_count INT DEFAULT 0,
    created_by INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (created_by) REFERENCES users(id),
    INDEX idx_trigger_type (trigger_type),
    INDEX idx_is_active (is_active)
);

-- å·¥ä½œæµåŸ·è¡Œè¨˜éŒ„è¡¨
CREATE TABLE workflow_executions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    workflow_id INT NOT NULL,
    triggered_by INT,
    status ENUM('running', 'completed', 'failed', 'cancelled') DEFAULT 'running',
    input_data JSON,
    output_data JSON,
    error_message TEXT,
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP NULL,
    execution_time INT, -- åŸ·è¡Œæ™‚é–“(ç§’)
    FOREIGN KEY (workflow_id) REFERENCES workflows(id),
    FOREIGN KEY (triggered_by) REFERENCES users(id),
    INDEX idx_workflow_id (workflow_id),
    INDEX idx_status (status),
    INDEX idx_started_at (started_at)
);

-- ç³»çµ±æ—¥èªŒè¡¨
CREATE TABLE audit_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100) NOT NULL,
    resource_type VARCHAR(50),
    resource_id INT,
    details JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    INDEX idx_user_id (user_id),
    INDEX idx_action (action),
    INDEX idx_created_at (created_at)
);
```

---

## ğŸ”§ å¾Œç«¯ API è¨­è¨ˆç¯„ä¾‹

### **è·¯ç”±çµæ§‹ (å« Swagger)**

```javascript
// routes/chat.js
const express = require("express");
const router = express.Router();
const chatController = require("../controllers/chatController");
const { auth, validate } = require("../middleware");

/**
 * @swagger
 * /api/chat/conversations:
 *   get:
 *     summary: ç²å–ç”¨æˆ¶å°è©±åˆ—è¡¨
 *     tags: [Chat]
 *     security:
 *       - bearerAuth: []
 *     parameters:
 *       - in: query
 *         name: page
 *         schema:
 *           type: integer
 *           default: 1
 *         description: é ç¢¼
 *       - in: query
 *         name: limit
 *         schema:
 *           type: integer
 *           default: 20
 *         description: æ¯é æ•¸é‡
 *     responses:
 *       200:
 *         description: æˆåŠŸç²å–å°è©±åˆ—è¡¨
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 success:
 *                   type: boolean
 *                 data:
 *                   type: array
 *                   items:
 *                     $ref: '#/components/schemas/Conversation'
 *                 pagination:
 *                   $ref: '#/components/schemas/Pagination'
 */
router.get("/conversations", auth, chatController.getConversations);

/**
 * @swagger
 * /api/chat/conversations:
 *   post:
 *     summary: å‰µå»ºæ–°å°è©±
 *     tags: [Chat]
 *     security:
 *       - bearerAuth: []
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             required:
 *               - model_id
 *             properties:
 *               model_id:
 *                 type: integer
 *                 description: AIæ¨¡å‹ID
 *               agent_id:
 *                 type: integer
 *                 description: æ™ºèƒ½é«”ID (å¯é¸)
 *               title:
 *                 type: string
 *                 description: å°è©±æ¨™é¡Œ
 *     responses:
 *       201:
 *         description: å°è©±å‰µå»ºæˆåŠŸ
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 success:
 *                   type: boolean
 *                 data:
 *                   $ref: '#/components/schemas/Conversation'
 */
router.post(
  "/conversations",
  auth,
  validate("createConversation"),
  chatController.createConversation
);

/**
 * @swagger
 * /api/chat/conversations/{id}/messages:
 *   post:
 *     summary: ç™¼é€è¨Šæ¯
 *     tags: [Chat]
 *     security:
 *       - bearerAuth: []
 *     parameters:
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: integer
 *         description: å°è©±ID
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             required:
 *               - content
 *             properties:
 *               content:
 *                 type: string
 *                 description: è¨Šæ¯å…§å®¹
 *               attachments:
 *                 type: array
 *                 items:
 *                   type: object
 *                   properties:
 *                     type:
 *                       type: string
 *                     url:
 *                       type: string
 *                     name:
 *                       type: string
 *     responses:
 *       200:
 *         description: è¨Šæ¯ç™¼é€æˆåŠŸ
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 success:
 *                   type: boolean
 *                 data:
 *                   type: object
 *                   properties:
 *                     userMessage:
 *                       $ref: '#/components/schemas/Message'
 *                     assistantMessage:
 *                       $ref: '#/components/schemas/Message'
 */
router.post(
  "/conversations/:id/messages",
  auth,
  validate("sendMessage"),
  chatController.sendMessage
);

module.exports = router;
```

### **æ§åˆ¶å™¨ç¯„ä¾‹**

```javascript
// controllers/chatController.js
const chatService = require("../services/chatService");
const { successResponse, errorResponse } = require("../utils/response");

class ChatController {
  /**
   * ç²å–ç”¨æˆ¶å°è©±åˆ—è¡¨
   */
  async getConversations(req, res, next) {
    try {
      const { page = 1, limit = 20 } = req.query;
      const userId = req.user.id;

      const result = await chatService.getUserConversations(userId, {
        page,
        limit,
      });

      return successResponse(res, result, "ç²å–å°è©±åˆ—è¡¨æˆåŠŸ");
    } catch (error) {
      next(error);
    }
  }

  /**
   * å‰µå»ºæ–°å°è©±
   */
  async createConversation(req, res, next) {
    try {
      const { model_id, agent_id, title } = req.body;
      const userId = req.user.id;

      const conversation = await chatService.createConversation({
        user_id: userId,
        model_id,
        agent_id,
        title,
      });

      return successResponse(res, conversation, "å°è©±å‰µå»ºæˆåŠŸ", 201);
    } catch (error) {
      next(error);
    }
  }

  /**
   * ç™¼é€è¨Šæ¯
   */
  async sendMessage(req, res, next) {
    try {
      const { id: conversationId } = req.params;
      const { content, attachments } = req.body;
      const userId = req.user.id;

      const result = await chatService.sendMessage({
        conversationId,
        userId,
        content,
        attachments,
      });

      return successResponse(res, result, "è¨Šæ¯ç™¼é€æˆåŠŸ");
    } catch (error) {
      next(error);
    }
  }

  /**
   * ç²å–å°è©±è¨Šæ¯
   */
  async getMessages(req, res, next) {
    try {
      const { id: conversationId } = req.params;
      const { page = 1, limit = 50 } = req.query;
      const userId = req.user.id;

      const messages = await chatService.getConversationMessages(
        conversationId,
        userId,
        { page, limit }
      );

      return successResponse(res, messages, "ç²å–è¨Šæ¯æˆåŠŸ");
    } catch (error) {
      next(error);
    }
  }

  /**
   * åˆªé™¤å°è©±
   */
  async deleteConversation(req, res, next) {
    try {
      const { id: conversationId } = req.params;
      const userId = req.user.id;

      await chatService.deleteConversation(conversationId, userId);

      return successResponse(res, null, "å°è©±åˆªé™¤æˆåŠŸ");
    } catch (error) {
      next(error);
    }
  }
}

module.exports = new ChatController();
```

### **Swagger é…ç½®**

````javascript
// config/swagger.js
const swaggerJsdoc = require('swagger-jsdoc');
const swaggerUi = require('swagger-ui-express');

const options = {
  definition: {
    openapi: '3.0.0',
    info: {
      title: 'sfda_nexus API',
      version: '1.0.0',
      description: 'ä¼æ¥­AIèŠå¤©ç³»çµ± API æ–‡æª”',
      contact: {
        name: 'API Support',
        email: 'support@company.com'
      }
    },
    servers: [
      {
        url: process.env.API_BASE_URL || 'http://localhost:3000',
        description: 'é–‹ç™¼ç’°å¢ƒ'
      }
    ],
    components: {
      securitySchemes: {
        bearerAuth: {
          type: 'http',
          scheme: 'bearer',
          bearerFormat: 'JWT'
        }
      },
      schemas: {
        User: {
          ```javascript
        User: {
          type: 'object',
          properties: {
            id: {
              type: 'integer',
              description: 'ç”¨æˆ¶ID'
            },
            username: {
              type: 'string',
              description: 'ç”¨æˆ¶å'
            },
            email: {
              type: 'string',
              format: 'email',
              description: 'é›»å­éƒµä»¶'
            },
            role: {
              type: 'string',
              enum: ['user', 'admin'],
              description: 'ç”¨æˆ¶è§’è‰²'
            },
            department: {
              type: 'string',
              description: 'éƒ¨é–€'
            },
            avatar_url: {
              type: 'string',
              description: 'é ­åƒURL'
            },
            is_active: {
              type: 'boolean',
              description: 'æ˜¯å¦å•Ÿç”¨'
            },
            created_at: {
              type: 'string',
              format: 'date-time',
              description: 'å‰µå»ºæ™‚é–“'
            }
          }
        },
        Conversation: {
          type: 'object',
          properties: {
            id: {
              type: 'integer',
              description: 'å°è©±ID'
            },
            user_id: {
              type: 'integer',
              description: 'ç”¨æˆ¶ID'
            },
            agent_id: {
              type: 'integer',
              nullable: true,
              description: 'æ™ºèƒ½é«”ID'
            },
            model_id: {
              type: 'integer',
              description: 'æ¨¡å‹ID'
            },
            title: {
              type: 'string',
              description: 'å°è©±æ¨™é¡Œ'
            },
            message_count: {
              type: 'integer',
              description: 'è¨Šæ¯æ•¸é‡'
            },
            total_tokens: {
              type: 'integer',
              description: 'ç¸½tokenæ•¸'
            },
            total_cost: {
              type: 'number',
              format: 'float',
              description: 'ç¸½è²»ç”¨'
            },
            created_at: {
              type: 'string',
              format: 'date-time',
              description: 'å‰µå»ºæ™‚é–“'
            },
            updated_at: {
              type: 'string',
              format: 'date-time',
              description: 'æ›´æ–°æ™‚é–“'
            },
            agent_name: {
              type: 'string',
              description: 'æ™ºèƒ½é«”åç¨±'
            },
            model_name: {
              type: 'string',
              description: 'æ¨¡å‹åç¨±'
            }
          }
        },
        Message: {
          type: 'object',
          properties: {
            id: {
              type: 'integer',
              description: 'è¨Šæ¯ID'
            },
            conversation_id: {
              type: 'integer',
              description: 'å°è©±ID'
            },
            role: {
              type: 'string',
              enum: ['user', 'assistant', 'system'],
              description: 'è§’è‰²'
            },
            content: {
              type: 'string',
              description: 'è¨Šæ¯å…§å®¹'
            },
            attachments: {
              type: 'array',
              items: {
                type: 'object',
                properties: {
                  type: {
                    type: 'string',
                    description: 'é™„ä»¶é¡å‹'
                  },
                  url: {
                    type: 'string',
                    description: 'é™„ä»¶URL'
                  },
                  name: {
                    type: 'string',
                    description: 'é™„ä»¶åç¨±'
                  },
                  size: {
                    type: 'integer',
                    description: 'é™„ä»¶å¤§å°'
                  }
                }
              },
              description: 'é™„ä»¶åˆ—è¡¨'
            },
            tokens_used: {
              type: 'integer',
              description: 'ä½¿ç”¨çš„tokenæ•¸'
            },
            cost: {
              type: 'number',
              format: 'float',
              description: 'è²»ç”¨'
            },
            created_at: {
              type: 'string',
              format: 'date-time',
              description: 'å‰µå»ºæ™‚é–“'
            }
          }
        },
        Agent: {
          type: 'object',
          properties: {
            id: {
              type: 'integer',
              description: 'æ™ºèƒ½é«”ID'
            },
            name: {
              type: 'string',
              description: 'æ™ºèƒ½é«”åç¨±'
            },
            display_name: {
              type: 'string',
              description: 'é¡¯ç¤ºåç¨±'
            },
            description: {
              type: 'string',
              description: 'æè¿°'
            },
            avatar_url: {
              type: 'string',
              description: 'é ­åƒURL'
            },
            system_prompt: {
              type: 'string',
              description: 'ç³»çµ±æç¤ºè©'
            },
            model_id: {
              type: 'integer',
              description: 'é—œè¯æ¨¡å‹ID'
            },
            capabilities: {
              type: 'object',
              description: 'èƒ½åŠ›é…ç½®'
            },
            is_active: {
              type: 'boolean',
              description: 'æ˜¯å¦å•Ÿç”¨'
            },
            usage_count: {
              type: 'integer',
              description: 'ä½¿ç”¨æ¬¡æ•¸'
            }
          }
        },
        AIModel: {
          type: 'object',
          properties: {
            id: {
              type: 'integer',
              description: 'æ¨¡å‹ID'
            },
            name: {
              type: 'string',
              description: 'æ¨¡å‹åç¨±'
            },
            display_name: {
              type: 'string',
              description: 'é¡¯ç¤ºåç¨±'
            },
            model_type: {
              type: 'string',
              enum: ['ollama', 'gemini'],
              description: 'æ¨¡å‹é¡å‹'
            },
            model_id: {
              type: 'string',
              description: 'æ¨¡å‹æ¨™è­˜ç¬¦'
            },
            endpoint_url: {
              type: 'string',
              description: 'ç«¯é»URL'
            },
            is_active: {
              type: 'boolean',
              description: 'æ˜¯å¦å•Ÿç”¨'
            },
            is_multimodal: {
              type: 'boolean',
              description: 'æ˜¯å¦æ”¯æ´å¤šæ¨¡æ…‹'
            },
            max_tokens: {
              type: 'integer',
              description: 'æœ€å¤§tokenæ•¸'
            }
          }
        },
        Pagination: {
          type: 'object',
          properties: {
            page: {
              type: 'integer',
              description: 'ç•¶å‰é ç¢¼'
            },
            limit: {
              type: 'integer',
              description: 'æ¯é æ•¸é‡'
            },
            total: {
              type: 'integer',
              description: 'ç¸½è¨˜éŒ„æ•¸'
            },
            totalPages: {
              type: 'integer',
              description: 'ç¸½é æ•¸'
            }
          }
        },
        Error: {
          type: 'object',
          properties: {
            success: {
              type: 'boolean',
              example: false
            },
            message: {
              type: 'string',
              description: 'éŒ¯èª¤è¨Šæ¯'
            },
            code: {
              type: 'string',
              description: 'éŒ¯èª¤ä»£ç¢¼'
            },
            details: {
              type: 'object',
              description: 'éŒ¯èª¤è©³æƒ…'
            }
          }
        }
      }
    }
  },
  apis: ['./src/routes/*.js'] // æƒæè·¯ç”±æ–‡ä»¶ä¸­çš„è¨»é‡‹
};

const specs = swaggerJsdoc(options);

module.exports = {
  specs,
  swaggerUi,
  setup: swaggerUi.setup(specs, {
    explorer: true,
    customCss: '.swagger-ui .topbar { display: none }',
    customSiteTitle: 'sfda_nexus API æ–‡æª”'
  })
};
````

---

## ğŸ”„ é–‹ç™¼éšæ®µè¦åŠƒ

### **ç¬¬ä¸€æœŸ - æ ¸å¿ƒåŠŸèƒ½ (3-4 é€±)**

#### **Week 1: åŸºç¤æ¶æ§‹æ­å»º**

- [x] å°ˆæ¡ˆåˆå§‹åŒ– (å‰å¾Œç«¯)
- [x] è³‡æ–™åº«è¨­è¨ˆèˆ‡å»ºç«‹
- [x] èªè­‰ç³»çµ± (JWT)
- [x] åŸºç¤è·¯ç”±èˆ‡ä¸­é–“ä»¶
- [x] Swagger API æ–‡æª”è¨­ç½®

#### **Week 2: èŠå¤©æ ¸å¿ƒåŠŸèƒ½**

- [x] èŠå¤©ç•Œé¢é–‹ç™¼ (Vue + Ant Design)
- [x] WebSocket å¯¦æ™‚é€šä¿¡
- [x] Ollama æ¨¡å‹æ•´åˆ
- [x] æª”æ¡ˆä¸Šå‚³åŠŸèƒ½
- [x] è¨Šæ¯å­˜å„²èˆ‡æŸ¥è©¢

#### **Week 3: æ¨¡å‹èˆ‡æ™ºèƒ½é«”ç®¡ç†**

- [x] AI æ¨¡å‹ç®¡ç† (CRUD)
- [x] Gemini API æ•´åˆ
- [x] æ™ºèƒ½é«”ç³»çµ±é–‹ç™¼
- [x] å‘½ä»¤è©æ¨¡æ¿åŠŸèƒ½
- [x] ç®¡ç†å“¡ç•Œé¢é–‹ç™¼

#### **Week 4: ç³»çµ±å®Œå–„**

- [x] ç”¨æˆ¶æ¬Šé™ç³»çµ±
- [x] ç³»çµ±ç›£æ§èˆ‡æ—¥èªŒ
- [x] éŒ¯èª¤è™•ç†èˆ‡é©—è­‰
- [x] å–®å…ƒæ¸¬è©¦
- [x] éƒ¨ç½²é…ç½®

### **ç¬¬äºŒæœŸ - é€²éšåŠŸèƒ½ (2-3 é€±)**

#### **Week 5-6: å·¥ä½œæµç³»çµ±**

- [ ] å·¥ä½œæµè¨­è¨ˆå™¨
- [ ] å·¥ä½œæµåŸ·è¡Œå¼•æ“
- [ ] æ’ç¨‹ä»»å‹™ç³»çµ±
- [ ] åŸ·è¡Œç›£æ§èˆ‡æ—¥èªŒ

#### **Week 7: çŸ¥è­˜åº«èˆ‡ MCP å·¥å…·**

- [ ] å‘é‡è³‡æ–™åº«æ•´åˆ (Qdrant)
- [ ] æ–‡æª”ä¸Šå‚³èˆ‡è™•ç†
- [ ] MCP å·¥å…·é–‹ç™¼
- [ ] çŸ¥è­˜æª¢ç´¢åŠŸèƒ½

### **ç¬¬ä¸‰æœŸ - å„ªåŒ–èˆ‡æ“´å±• (2 é€±)**

#### **Week 8-9: ç³»çµ±å„ªåŒ–**

- [ ] æ€§èƒ½å„ªåŒ–
- [ ] å®‰å…¨æ€§åŠ å¼·
- [ ] ç›£æ§èˆ‡åˆ†æ
- [ ] ç”¨æˆ¶é«”é©—å„ªåŒ–

---

## ğŸ› ï¸ é–‹ç™¼ç’°å¢ƒè¨­ç½®

### **å‰ç«¯é–‹ç™¼ç’°å¢ƒ**

```json
// frontend/package.json
{
  "name": "sfda-nexus-frontend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext .vue,.js,.jsx,.cjs,.mjs --fix",
    "format": "prettier --write src/"
  },
  "dependencies": {
    "vue": "^3.4.0",
    "vue-router": "^4.2.5",
    "pinia": "^2.1.7",
    "ant-design-vue": "^4.0.0",
    "@ant-design/icons-vue": "^7.0.0",
    "axios": "^1.6.0",
    "dayjs": "^1.11.10",
    "marked": "^9.1.0",
    "highlight.js": "^11.9.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.5.0",
    "vite": "^5.0.0",
    "eslint": "^8.55.0",
    "eslint-plugin-vue": "^9.19.0",
    "prettier": "^3.1.0",
    "@vue/eslint-config-prettier": "^8.0.0"
  }
}
```

```javascript
// frontend/vite.config.js
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import { resolve } from "path";

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      "@": resolve(__dirname, "src"),
    },
  },
  server: {
    port: 8080,
    proxy: {
      "/api": {
        target: "http://localhost:3000",
        changeOrigin: true,
      },
      "/ws": {
        target: "ws://localhost:3000",
        ws: true,
      },
    },
  },
  build: {
    outDir: "../backend/public",
    emptyOutDir: true,
  },
});
```

### **å¾Œç«¯é–‹ç™¼ç’°å¢ƒ**

```json
// backend/package.json
{
  "name": "sfda-nexus-backend",
  "version": "1.0.0",
  "type": "commonjs",
  "scripts": {
    "dev": "nodemon server.js",
    "start": "node server.js",
    "test": "jest",
    "test:watch": "jest --watch",
    "migrate": "node database/migrate.js",
    "seed": "node database/seed.js",
    "lint": "eslint . --fix",
    "format": "prettier --write ."
  },
  "dependencies": {
    "express": "^4.18.2",
    "mysql2": "^3.6.5",
    "bcryptjs": "^2.4.3",
    "jsonwebtoken": "^9.0.2",
    "multer": "^1.4.5",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "axios": "^1.6.0",
    "ws": "^8.14.2",
    "joi": "^17.11.0",
    "helmet": "^7.1.0",
    "express-rate-limit": "^7.1.5",
    "winston": "^3.11.0",
    "swagger-jsdoc": "^6.2.8",
    "swagger-ui-express": "^5.0.0",
    "crypto-js": "^4.2.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.2",
    "jest": "^29.7.0",
    "supertest": "^6.3.3",
    "eslint": "^8.55.0",
    "prettier": "^3.1.0"
  }
}
```

### **ç’°å¢ƒè®Šé‡é…ç½®**

```env
# backend/.env.example
# æœå‹™å™¨é…ç½®
NODE_ENV=development
PORT=3000
API_BASE_URL=http://localhost:3000

# è³‡æ–™åº«é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=sfda_nexus
DB_USER=root
DB_PASSWORD=your_password

# JWTé…ç½®
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=7d

# AIæ¨¡å‹é…ç½®
OLLAMA_BASE_URL=http://localhost:11434
GEMINI_API_KEY=your_gemini_api_key

# æª”æ¡ˆä¸Šå‚³é…ç½®
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=10485760

# æ—¥èªŒé…ç½®
LOG_LEVEL=info
LOG_DIR=./logs

# å®‰å…¨é…ç½®
BCRYPT_ROUNDS=12
RATE_LIMIT_WINDOW=15
RATE_LIMIT_MAX=100

# WebSocketé…ç½®
WS_PORT=3001

# å‘é‡è³‡æ–™åº«é…ç½® (ç¬¬äºŒæœŸ)
QDRANT_URL=http://localhost:6333
QDRANT_API_KEY=your_qdrant_api_key
```

---

## ğŸ³ Docker éƒ¨ç½²é…ç½®

### **Dockerfile**

```dockerfile
# å¤šéšæ®µæ§‹å»º
FROM node:18-alpine AS frontend-builder

WORKDIR /app/frontend
COPY frontend/package*.json ./
RUN npm ci --only=production

COPY frontend/ ./
RUN npm run build

FROM node:18-alpine AS backend

WORKDIR /app

# å®‰è£å¾Œç«¯ä¾è³´
COPY backend/package*.json ./
RUN npm ci --only=production

# è¤‡è£½å¾Œç«¯ä»£ç¢¼
COPY backend/ ./

# è¤‡è£½å‰ç«¯æ§‹å»ºçµæœ
COPY --from=frontend-builder /app/backend/public ./public

# å‰µå»ºå¿…è¦ç›®éŒ„
RUN mkdir -p uploads logs

# è¨­ç½®æ¬Šé™
RUN chown -R node:node /app
USER node

EXPOSE 3000

HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

CMD ["npm", "start"]
```

### **docker-compose.yml**

```yaml
version: "3.8"

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=mysql
      - DB_NAME=sfda_nexus
      - DB_USER=sfda_user
      - DB_PASSWORD=${DB_PASSWORD}
      - JWT_SECRET=${JWT_SECRET}
      - OLLAMA_BASE_URL=http://ollama:11434
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    depends_on:
      mysql:
        condition: service_healthy
      ollama:
        condition: service_started
    volumes:
      - app_uploads:/app/uploads
      - app_logs:/app/logs
    networks:
      - sfda_network
    restart: unless-stopped

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=sfda_nexus
      - MYSQL_USER=sfda_user
      - MYSQL_PASSWORD=${DB_PASSWORD}
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/schema.sql:/docker-entrypoint-initdb.d/01-schema.sql
      - ./database/seeds:/docker-entrypoint-initdb.d/seeds
    ports:
      - "3306:3306"
    networks:
      - sfda_network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      timeout: 20s
      retries: 10
    restart: unless-stopped

  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama_data:/root/.ollama
    networks:
      - sfda_network
    environment:
      - OLLAMA_ORIGINS=*
    restart: unless-stopped

  # ç¬¬äºŒæœŸæ–°å¢ï¼šå‘é‡è³‡æ–™åº«
  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    networks:
      - sfda_network
    restart: unless-stopped
    profiles:
      - stage2

  # ç›£æ§æœå‹™ (å¯é¸)
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app
    networks:
      - sfda_network
    restart: unless-stopped
    profiles:
      - production

volumes:
  mysql_data:
  ollama_data:
  qdrant_data:
  app_uploads:
  app_logs:

networks:
  sfda_network:
    driver: bridge
```

### **éƒ¨ç½²è…³æœ¬**

```bash
#!/bin/bash
# deploy.sh

set -e

echo "ğŸš€ é–‹å§‹éƒ¨ç½² sfda_nexus..."

# æª¢æŸ¥ç’°å¢ƒè®Šé‡
if [ ! -f .env ]; then
    echo "âŒ è«‹å…ˆå‰µå»º .env æ–‡ä»¶"
    exit 1
fi

# è¼‰å…¥ç’°å¢ƒè®Šé‡
source .env

# åœæ­¢ç¾æœ‰æœå‹™
echo "â¹ï¸  åœæ­¢ç¾æœ‰æœå‹™..."
docker-compose down

# æ‹‰å–æœ€æ–°é¡åƒ
echo "ğŸ“¥ æ‹‰å–æœ€æ–°é¡åƒ..."
docker-compose pull

# æ§‹å»ºæ‡‰ç”¨é¡åƒ
echo "ğŸ”¨ æ§‹å»ºæ‡‰ç”¨é¡åƒ..."
docker-compose build app

# å•Ÿå‹•æœå‹™
echo "â–¶ï¸  å•Ÿå‹•æœå‹™..."
docker-compose up -d

# ç­‰å¾…æœå‹™å•Ÿå‹•
echo "â³ ç­‰å¾…æœå‹™å•Ÿå‹•..."
sleep 30

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
echo "ğŸ—„ï¸  åŸ·è¡Œè³‡æ–™åº«é·ç§»..."
docker-compose exec app npm run migrate

# åŸ·è¡Œè³‡æ–™åº«ç¨®å­
echo "ğŸŒ± åŸ·è¡Œè³‡æ–™åº«ç¨®å­..."
docker-compose exec app npm run seed

# æª¢æŸ¥æœå‹™ç‹€æ…‹
echo "âœ… æª¢æŸ¥æœå‹™ç‹€æ…‹..."
docker-compose ps

echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
echo "ğŸ“Š ç®¡ç†ç•Œé¢: http://localhost:3000"
echo "ğŸ“š APIæ–‡æª”: http://localhost:3000/api-docs"
```

---

## ğŸ“Š ç›£æ§èˆ‡æ—¥èªŒ

### **æ—¥èªŒé…ç½®**

```javascript
// utils/logger.js
const winston = require("winston");
const path = require("path");

const logDir = process.env.LOG_DIR || "./logs";

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || "info",
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: { service: "sfda-nexus" },
  transports: [
    // éŒ¯èª¤æ—¥èªŒ
    new winston.transports.File({
      filename: path.join(logDir, "error.log"),
      level: "error",
      maxsize: 5242880, // 5MB
      maxFiles: 5,
    }),
    // æ‰€æœ‰æ—¥èªŒ
    new winston.transports.File({
      filename: path.join(logDir, "combined.log"),
      maxsize: 5242880,
      maxFiles: 5,
    }),
    // å¯©è¨ˆæ—¥èªŒ
    new winston.transports.File({
      filename: path.join(logDir, "audit.log"),
      level: "info",
      maxsize: 5242880,
      maxFiles: 10,
    }),
  ],
});

// é–‹ç™¼ç’°å¢ƒä¸‹è¼¸å‡ºåˆ°æ§åˆ¶å°
if (process.env.NODE_ENV !== "production") {
  logger.add(
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      ),
    })
  );
}

module.exports = logger;
```

### **å¥åº·æª¢æŸ¥ç«¯é»**

```javascript
// routes/health.js
const express = require("express");
const router = express.Router();
const db = require("../utils/database");

router.get("/health", async (req, res) => {
  const health = {
    status: "ok",
    timestamp: new Date().toISOString(),
    services: {},
  };

  try {
    // æª¢æŸ¥è³‡æ–™åº«é€£æ¥
    await db.query("SELECT 1");
    health.services.database = "ok";
  } catch (error) {
    health.services.database = "error";
    health.status = "error";
  }

  // æª¢æŸ¥ Ollama é€£æ¥
  try {
    const response = await axios.get(`${process.env.OLLAMA_BASE_URL}/api/tags`);
    health.services.ollama = response.status === 200 ? "ok" : "error";
  } catch (error) {
    health.services.ollama = "error";
  }

  const statusCode = health.status === "ok" ? 200 : 503;
  res.status(statusCode).json(health);
});

module.exports = router;
```

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### **æ¸¬è©¦çµæ§‹**

```
tests/
â”œâ”€â”€ unit/                    # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ models/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ integration/             # æ•´åˆæ¸¬è©¦
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ database/
â”‚   â””â”€â”€ websocket/
â”œâ”€â”€ e2e/                     # ç«¯åˆ°ç«¯æ¸¬è©¦
â”‚   â”œâ”€â”€ auth.test.js
â”‚   â”œâ”€â”€ chat.test.js
â”‚   â””â”€â”€ admin.test.js
â”œâ”€â”€ fixtures/                # æ¸¬è©¦æ•¸æ“š
â”‚   â”œâ”€â”€ users.json
â”‚   â”œâ”€â”€ models.json
â”‚   â””â”€â”€ conversations.json
â””â”€â”€ setup/                   # æ¸¬è©¦è¨­ç½®
    â”œâ”€â”€ database.js
    â”œâ”€â”€ server.js
    â””â”€â”€ cleanup.js
```

### **æ¸¬è©¦ç¯„ä¾‹**

```javascript
// tests/integration/api/chat.test.js
const request = require("supertest");
const app = require("../../../server");
const db = require("../../../src/utils/database");

describe("Chat API", () => {
  let authToken;
  let userId;

  beforeAll(async () => {
    // å‰µå»ºæ¸¬è©¦ç”¨æˆ¶ä¸¦ç²å–token
    const response = await request(app).post("/api/auth/login").send({
      username: "testuser",
      password: "testpass",
    });

    authToken = response.body.data.token;
    userId = response.body.data.user.id;
  });

  afterAll(async () => {
    // æ¸…ç†æ¸¬è©¦æ•¸æ“š
    await db.query(
      "DELETE FROM messages WHERE conversation_id IN (SELECT id FROM conversations WHERE user_id = ?)",
      [userId]
    );
    await db.query("DELETE FROM conversations WHERE user_id = ?", [userId]);
  });

  describe("POST /api/chat/conversations", () => {
    it("should create a new conversation", async () => {
      const response = await request(app)
        .post("/api/chat/conversations")
        .set("Authorization", `Bearer ${authToken}`)
        .send({
          model_id: 1,
          title: "Test Conversation",
        });

      expect(response.status).toBe(201);
      expect(response.body.success).toBe(true);
      expect(response.body.data).toHaveProperty("id");
      expect(response.body.data.title).toBe("Test Conversation");
    });

    it("should return 400 for invalid model_id", async () => {
      const response = await request(app)
        .post("/api/chat/conversations")
        .set("Authorization", `Bearer ${authToken}`)
        .send({
          model_id: 999,
          title: "Test Conversation",
        });

      expect(response.status).toBe(400);
      expect(response.body.success).toBe(false);
    });
  });

  describe("POST /api/chat/conversations/:id/messages", () => {
    let conversationId;

    beforeEach(async () => {
      const response = await request(app)
        .post("/api/chat/conversations")
        .set("Authorization", `Bearer ${authToken}`)
        .send({
          model_id: 1,
          title: "Test Conversation",
        });

      conversationId = response.body.data.id;
    });

    it("should send a message and receive AI response", async () => {
      const response = await request(app)
        .post(`/api/chat/conversations/${conversationId}/messages`)
        .set("Authorization", `Bearer ${authToken}`)
        .send({
          content: "Hello, how are you?",
        });

      expect(response.status).toBe(200);
      expect(response.body.success).toBe(true);
      expect(response.body.data).toHaveProperty("userMessage");
      expect(response.body.data).toHaveProperty("assistantMessage");
      expect(response.body.data.userMessage.content).toBe(
        "Hello, how are you?"
      );
    });
  });
});
```

---

## ğŸ“ˆ æ€§èƒ½å„ªåŒ–å»ºè­°

### **è³‡æ–™åº«å„ªåŒ–**

- æ·»åŠ é©ç•¶çš„ç´¢å¼•
- ä½¿ç”¨é€£æ¥æ± 
- å¯¦æ–½æŸ¥è©¢å¿«å–
- å®šæœŸæ¸…ç†èˆŠæ•¸æ“š

### **API å„ªåŒ–**

- å¯¦æ–½åˆ†é 
- ä½¿ç”¨å£“ç¸®ä¸­é–“ä»¶
- æ·»åŠ å¿«å–å±¤ (Redis)
- API é™æµ

### **å‰ç«¯å„ªåŒ–**

- çµ„ä»¶æ‡¶åŠ è¼‰
- åœ–ç‰‡å£“ç¸®èˆ‡ CDN
- æ‰“åŒ…å„ªåŒ–
- æœå‹™ç«¯æ¸²æŸ“ (å¯é¸)

---

## ğŸ”’ å®‰å…¨æ€§è€ƒæ…®

### **èªè­‰èˆ‡æˆæ¬Š**

- JWT token éæœŸæ©Ÿåˆ¶
- è§’è‰²æ¬Šé™æ§åˆ¶
- API é™æµ
- è¼¸å…¥é©—è­‰èˆ‡æ¸…ç†

### **æ•¸æ“šå®‰å…¨**

- API Key åŠ å¯†å­˜å„²
- æ•æ„Ÿæ•¸æ“šè„«æ•
- SQL æ³¨å…¥é˜²è­·
- XSS é˜²è­·

### **ç³»çµ±å®‰å…¨**

- HTTPS å¼·åˆ¶
- CORS é…ç½®
- å®‰å…¨æ¨™é ­è¨­ç½®
- å®šæœŸå®‰å…¨æ›´æ–°

---

## ğŸ“… é–‹ç™¼æ™‚ç¨‹è¡¨

| éšæ®µ   | æ™‚é–“     | ä¸»è¦åŠŸèƒ½       | é‡Œç¨‹ç¢‘     |
| ------ | -------- | -------------- | ---------- |
| ç¬¬ä¸€æœŸ | Week 1-4 | æ ¸å¿ƒèŠå¤©åŠŸèƒ½   | MVP ä¸Šç·š   |
| ç¬¬äºŒæœŸ | Week 5-7 | å·¥ä½œæµèˆ‡çŸ¥è­˜åº« | åŠŸèƒ½å®Œæ•´ç‰ˆ |
| ç¬¬ä¸‰æœŸ | Week 8-9 | å„ªåŒ–èˆ‡æ“´å±•     | ç”Ÿç”¢å°±ç·’ç‰ˆ |

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### **æŠ€è¡“æŒ‡æ¨™**

- API éŸ¿æ‡‰æ™‚é–“ < 500ms
- ç³»çµ±å¯ç”¨æ€§ > 99.5%
- ä¸¦ç™¼ç”¨æˆ¶æ•¸ > 100
- è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–

### **æ¥­å‹™æŒ‡æ¨™**

- ç”¨æˆ¶æ»¿æ„åº¦ > 4.5/5
- æ—¥æ´»èºç”¨æˆ¶æ•¸
- å¹³å‡å°è©±é•·åº¦
- åŠŸèƒ½ä½¿ç”¨ç‡

---

é€™å€‹é–‹ç™¼è¨ˆåŠƒæä¾›äº†å®Œæ•´çš„æŠ€è¡“æ¶æ§‹ã€é–‹ç™¼æµç¨‹å’Œéƒ¨ç½²ç­–ç•¥ã€‚ä½ è¦ºå¾—é€™å€‹è¦åŠƒå¦‚ä½•ï¼Ÿéœ€è¦èª¿æ•´å“ªäº›éƒ¨åˆ†å—ï¼Ÿ
