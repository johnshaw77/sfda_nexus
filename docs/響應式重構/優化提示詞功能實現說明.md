# 優化提示詞功能實現說明

## 功能概述

優化提示詞功能允許用戶輸入一個提示詞，系統會使用 qwen3:8b 模型來分析並優化該提示詞，提供更清晰、更有效的表達方式。

## 技術實現

### 後端實現

#### 1. API 端點

- **路徑**: `POST /api/chat/optimize-prompt`
- **認證**: 需要 Bearer Token
- **速率限制**: 1 分鐘 30 次請求

#### 2. 請求格式

```json
{
  "prompt": "用戶輸入的提示詞（必填，最大2000字符）",
  "context": "可選的上下文信息（最大500字符）"
}
```

#### 3. 回應格式

```json
{
  "success": true,
  "data": {
    "original_prompt": "原始提示詞",
    "optimized_prompt": "優化後的提示詞",
    "improvements": ["改進要點1", "改進要點2"],
    "confidence": 85,
    "model_info": {
      "id": 42,
      "name": "qwen3:8b",
      "display_name": "Qwen3 8B",
      "provider": "ollama"
    }
  },
  "message": "優化完成"
}
```

#### 4. 核心邏輯

- 固定使用模型 ID 42（qwen3:8b）
- 設置溫度為 0.3 確保穩定性
- 最大 token 數為 1500
- 包含專業的系統提示詞指導優化

### 前端實現

#### 1. 組件修改

- **文件**: `frontend/src/views/chat/components/ChatArea.vue`
- **新增功能**:
  - 優化提示詞按鈕（Sparkles 圖標）
  - 優化結果顯示模態框
  - 應用優化結果功能

#### 2. API 集成

- **文件**: `frontend/src/api/chat.js`
- **新增函數**: `optimizePrompt(promptData)`

#### 3. 用戶界面

- **按鈕位置**: 輸入工具欄左側，模型選擇器旁邊
- **按鈕狀態**:
  - 正常狀態：藍色 Sparkles 圖標
  - 載入狀態：顯示載入動畫
  - 禁用狀態：當輸入框為空時禁用

#### 4. 優化結果模態框

- **寬度**: 800px，居中顯示
- **內容區域**:
  - 原始提示詞（灰色背景）
  - 優化後提示詞（藍綠漸變背景）
  - 改進要點列表
  - 優化信心度進度條
  - 使用的模型信息
- **操作按鈕**:
  - 關閉按鈕
  - 應用優化結果按鈕

## 使用流程

### 用戶操作流程

1. 用戶在聊天輸入框中輸入提示詞
2. 點擊工具欄中的優化提示詞按鈕（Sparkles 圖標）
3. 系統調用 API 進行優化（顯示載入狀態）
4. 優化完成後顯示結果模態框
5. 用戶可以查看優化結果並選擇應用

### 技術處理流程

1. 前端驗證輸入（非空、長度限制）
2. 調用後端 API
3. 後端使用 qwen3:8b 模型進行優化
4. 返回結構化結果
5. 前端顯示優化結果
6. 用戶選擇應用時替換輸入框內容

## 錯誤處理

### 前端錯誤處理

- 輸入驗證：提示詞為空或超過長度限制
- 網絡錯誤：顯示友好的錯誤消息
- API 錯誤：根據後端返回的錯誤信息提示用戶

### 後端錯誤處理

- 輸入驗證：檢查必填字段和長度限制
- 模型調用失敗：提供備用處理方案
- 解析錯誤：嘗試從回應中提取有用信息

## 樣式設計

### 按鈕樣式

- 正常狀態：藍色圖標，懸停時有背景色和縮放效果
- 禁用狀態：灰色圖標，無交互效果
- 載入狀態：顯示旋轉動畫

### 模態框樣式

- 現代化設計，符合系統整體風格
- 響應式佈局，支持不同屏幕尺寸
- 清晰的視覺層次，便於閱讀

## 配置說明

### 模型配置

- **固定模型**: qwen3:8b (ID: 42)
- **溫度設置**: 0.3（保證穩定性）
- **最大 Token**: 1500
- **提供商**: Ollama

### 限制設置

- **提示詞長度**: 最大 2000 字符
- **上下文長度**: 最大 500 字符
- **速率限制**: 1 分鐘 30 次請求

## 測試說明

### 測試文件

- **位置**: `frontend/src/test/test_optimize_prompt.js`
- **功能**: 提供自動化測試腳本

### 測試方法

1. 確保後端服務器運行
2. 在瀏覽器控制台載入測試腳本
3. 運行 `runAllTests()` 進行完整測試
4. 或使用 `testOptimizePrompt("提示詞", "上下文")` 測試單個案例

### 測試案例

- 簡單提示詞優化
- 複雜功能需求優化
- 技術性問題優化

## 注意事項

1. **模型依賴**: 功能依賴 qwen3:8b 模型，需確保模型可用
2. **認證要求**: 所有請求需要有效的認證 token
3. **性能考慮**: AI 調用可能需要較長時間，已添加適當的載入提示
4. **用戶體驗**: 優化結果以易讀的方式呈現，支持一鍵應用

## 未來優化方向

1. **模型選擇**: 允許用戶選擇不同的優化模型
2. **歷史記錄**: 保存優化歷史供用戶參考
3. **批量優化**: 支持同時優化多個提示詞
4. **個性化**: 根據用戶偏好調整優化風格
5. **評分系統**: 允許用戶對優化結果進行評分反饋
