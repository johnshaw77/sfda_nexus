# ChatArea.vue 重構計劃 2025-06-22

## 📋 重構目標
將 4011 行的巨型組件拆分為多個可維護的小組件，提升程式碼品質和開發效率。

## 🎯 重構原則
- 單一職責原則：每個組件只負責一個功能
- 最小化狀態傳遞：減少 props drilling
- 保持向後兼容：不影響現有功能
- 漸進式重構：分階段實施，確保穩定性

## 📅 重構時程表

### 第一階段：檔案處理系統重構 (預計 2-3 天) ✅ 已完成
- [x] **Task 1.1**: 創建 `FilePreview.vue` 組件 ✅
  - 提取檔案預覽功能 (約 300 行)
  - 包含：檔案縮圖、移除按鈕、圖片預覽
  - 時間：4-6 小時

- [x] **Task 1.2**: 創建 `FileActions.vue` 組件 ✅  
  - 提取檔案快速操作按鈕 (約 400 行)
  - 包含：各類檔案的專用操作按鈕
  - 時間：4-6 小時

- [x] **Task 1.3**: 創建 `useFileUpload.js` composable ✅
  - 提取檔案上傳邏輯 (約 200 行)
  - 包含：拖拉上傳、貼上上傳、檔案驗證
  - 時間：3-4 小時

- [x] **Task 1.4**: 創建 `useFileActions.js` composable ✅
  - 檔案操作處理邏輯
  - 時間：2-3 小時

### 第二階段：快速命令和設置重構 (預計 1-2 天) ✅ 已完成
- [x] **Task 2.1**: 創建 `QuickCommands.vue` 組件 ✅
  - 提取快速命令下拉選單 (約 200 行)
  - 包含：動態命令載入、靜態命令回退
  - 時間：3-4 小時

- [x] **Task 2.2**: 創建 `ChatSettings.vue` 組件 ✅
  - 提取聊天設置模態框 (約 150 行)
  - 包含：溫度、token、系統提示詞設置
  - 時間：2-3 小時

- [x] **Task 2.3**: 創建 `useChatSettings.js` composable ✅
  - 提取設置管理邏輯 (約 100 行)
  - 包含：設置載入、保存、智能體特定設置
  - 時間：2-3 小時

### 第三階段：消息輸入區域重構 (預計 2-3 天)
- [ ] **Task 3.1**: 創建 `MessageInput.vue` 組件
  - 提取消息輸入框和工具欄 (約 400 行)
  - 包含：輸入框、工具欄、折疊功能
  - 時間：4-5 小時

- [ ] **Task 3.2**: 創建 `InputToolbar.vue` 組件
  - 提取輸入工具欄 (約 200 行)
  - 包含：模型選擇、按鈕組
  - 時間：2-3 小時

- [ ] **Task 3.3**: 創建 `useInputResize.js` composable
  - 提取輸入區域調整邏輯 (約 100 行)
  - 包含：拖拉調整、折疊展開
  - 時間：2-3 小時

- [ ] **Task 3.4**: 創建 `QuotedMessage.vue` 組件
  - 提取引用消息顯示 (約 50 行)
  - 時間：1-2 小時

### 第四階段：聊天頭部和消息列表重構 (預計 2-3 天)
- [ ] **Task 4.1**: 創建 `ChatHeader.vue` 組件
  - 提取聊天頭部 (約 200 行)
  - 包含：智能體信息、對話信息、控制按鈕
  - 時間：3-4 小時

- [ ] **Task 4.2**: 創建 `WelcomeScreen.vue` 組件
  - 提取空狀態歡迎畫面 (約 100 行)
  - 包含：智能體介紹、快速提示
  - 時間：2-3 小時

- [ ] **Task 4.3**: 創建 `TypingIndicator.vue` 組件
  - 提取 AI 輸入狀態指示器 (約 50 行)
  - 時間：1-2 小時

- [ ] **Task 4.4**: 創建 `AgentMentionMenu.vue` 組件
  - 提取智能體提及選單 (約 100 行)
  - 時間：2-3 小時

### 第五階段：Composables 和工具函數 (預計 1-2 天)
- [ ] **Task 5.1**: 創建 `useMessageSending.js` composable
  - 提取消息發送邏輯 (約 200 行)
  - 包含：普通發送、串流發送、Qwen Agent
  - 時間：3-4 小時

- [ ] **Task 5.2**: 創建 `useQuickCommands.js` composable
  - 提取快速命令邏輯 (約 100 行)
  - 時間：2-3 小時

- [ ] **Task 5.3**: 創建 `useAgentMention.js` composable
  - 提取智能體提及邏輯 (約 100 行)
  - 時間：2-3 小時

### 第六階段：樣式重構和優化 (預計 1-2 天)
- [ ] **Task 6.1**: 創建模組化樣式檔案
  - 拆分 CSS 到各組件
  - 提取共用樣式變數
  - 時間：3-4 小時

- [ ] **Task 6.2**: 創建常量檔案
  - 提取硬編碼常量到 `constants/chatConstants.js`
  - 時間：1-2 小時

- [ ] **Task 6.3**: 最終整合測試
  - 功能測試、效能測試
  - 修復整合問題
  - 時間：2-3 小時

## 📊 重構統計

### 預計移除行數
- 主組件：從 4011 行 → 約 800-1000 行
- 移除比例：約 75-80%

### 新增檔案數量
- Vue 組件：12 個
- Composables：8 個  
- 樣式檔案：5 個
- 常量檔案：1 個
- 總計：26 個新檔案

### 時間投入
- 總工時：約 50-70 小時
- 工作天數：約 10-12 天 (按每天 5-6 小時計算)

## 🚀 開始執行

### 立即執行任務
1. **Task 1.1**: 創建 `FilePreview.vue` 組件
2. **Task 1.3**: 創建 `useFileUpload.js` composable

### 執行順序
按階段順序執行，每完成一個 Task 立即測試，確保功能正常後再進行下一個。

## 📝 注意事項
- 每個重構步驟都要保持功能完整性
- 重構過程中持續測試，避免引入 bug
- 保持 git commit 記錄清晰，便於回滾
- 重構完成後更新相關文件

---
**狀態**: 🟡 進行中  
**開始日期**: 2025-01-16  
**預計完成**: 2025-01-28 