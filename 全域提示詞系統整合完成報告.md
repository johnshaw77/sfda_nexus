# ğŸ‰ å…¨åŸŸæç¤ºè©ç³»çµ±æ•´åˆå®Œæˆå ±å‘Š

## ğŸ“‹ æ•´åˆæ¦‚æ³

**å®Œæˆæ—¥æœŸ**: 2025 å¹´ 06 æœˆ 11 æ—¥  
**æ•´åˆç‹€æ…‹**: âœ… **å®Œå…¨å®Œæˆ**  
**æ¸¬è©¦ç‹€æ…‹**: âœ… **åŠŸèƒ½é©—è­‰é€šé**

---

## å‘¼å«æµç¨‹

````mermaid
graph TD
    A["å‰ç«¯ç™¼é€æ¶ˆæ¯"] --> B["chat.controller.js<br/>handleSendMessage()"]
    B --> C["ç²å–åŸºç¤æç¤ºè©<br/>system_prompt æˆ– agent.system_prompt"]
    C --> D["chatService.generateSystemPrompt()"]
    D --> E["globalPromptService.integrateGlobalRules()"]
    E --> F["å¾è³‡æ–™åº«è¼‰å…¥å…¨åŸŸè¦å‰‡<br/>system_configs è¡¨"]
    F --> G["æ•´åˆ: å…¨åŸŸè¦å‰‡ + åŸºç¤æç¤ºè©"]
    G --> H["æ·»åŠ  MCP å·¥å…·è³‡è¨Š"]
    H --> I["ç”Ÿæˆå®Œæ•´ç³»çµ±æç¤ºè©<br/>6000+ å­—ç¬¦"]
    I --> J["æ·»åŠ åˆ° AI æ¨¡å‹ messages"]
    J --> K["èª¿ç”¨ AI æ¨¡å‹"]
    K --> L["è¿”å›å›æ‡‰çµ¦å‰ç«¯"]

    style A fill:#e1f5fe
    style B fill:#fff3e0
    style D fill:#f3e5f5
    style E fill:#e8f5e8
    style F fill:#fff8e1
    style I fill:#ffebee
    ```
## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### 1. è³‡æ–™åº«å±¤ âœ… **å·²å®Œæˆ**

#### `system_configs` è¡¨é…ç½®

```sql
-- å…¨åŸŸæç¤ºè©é…ç½®å·²æˆåŠŸå­˜å„²
config_key: 'global_prompt_rules'
content_length: 2815 å­—ç¬¦
status: âœ… å·²åœ¨è³‡æ–™åº«ä¸­ç¢ºèªå­˜åœ¨
````

#### åŸ·è¡Œè…³æœ¬

- âœ… `backend/database/scripts/add_global_prompt_config.sql` - å·²åŸ·è¡Œ
- âœ… å­—ç¬¦é›†é…ç½®ï¼šutf8mb4_unicode_ci
- âœ… è³‡æ–™å®Œæ•´æ€§æª¢æŸ¥é€šé

### 2. å¾Œç«¯æœå‹™å±¤ âœ… **å·²å®Œæˆ**

#### GlobalPromptService (`backend/src/services/globalPrompt.service.js`)

```javascript
âœ… åŠŸèƒ½å®Œæˆï¼š
- å¾è³‡æ–™åº«å‹•æ…‹è¼‰å…¥å…¨åŸŸè¦å‰‡
- 5åˆ†é˜æ™ºèƒ½å¿«å–æ©Ÿåˆ¶ (< 10ms éŸ¿æ‡‰)
- è‡ªå‹•é™ç´šè™•ç† (è³‡æ–™åº«å¤±æ•—æ™‚ä½¿ç”¨é è¨­è¦å‰‡)
- å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
- çµ±è¨ˆå’Œç›£æ§åŠŸèƒ½
```

#### ChatService æ•´åˆ (`backend/src/services/chat.service.js`)

```javascript
âœ… åŠŸèƒ½å®Œæˆï¼š
- è‡ªå‹•å°‡å…¨åŸŸè¦å‰‡æ•´åˆåˆ°æ‰€æœ‰ç³»çµ±æç¤ºè©
- å…¨åŸŸè¦å‰‡å„ªå…ˆç´šæ§åˆ¶ (æ”¾åœ¨æœ€å‰é¢)
- æ™ºèƒ½ prompt ç”Ÿæˆå’Œå·¥å…·æç¤ºæ•´åˆ
- å¿«å–ç®¡ç†å’Œæ€§èƒ½å„ªåŒ–
```

#### ç®¡ç† API (`backend/src/routes/admin.route.js`)

```javascript
âœ… API ç«¯é»ï¼š
- GET  /api/admin/global-prompt/preview        # è¦å‰‡é è¦½
- PUT  /api/admin/global-prompt/update         # æ›´æ–°è¦å‰‡
- POST /api/admin/global-prompt/system-prompt-preview # å®Œæ•´æç¤ºè©é è¦½
- POST /api/admin/global-prompt/cache/clear    # æ¸…é™¤å¿«å–
- GET  /api/admin/global-prompt/stats          # ç³»çµ±çµ±è¨ˆ
```

### 3. å‰ç«¯ç®¡ç†å±¤ âœ… **å·²å®Œæˆ**

#### é ç±¤æ•´åˆçµæ§‹

```
æ™ºèƒ½é«”ç®¡ç†é é¢ (/admin/agents)
â”œâ”€â”€ é ç±¤ 1: æ™ºèƒ½é«”ç®¡ç† (åŸæœ‰åŠŸèƒ½)
â””â”€â”€ é ç±¤ 2: å…¨åŸŸæç¤ºè© (æ–°å¢åŠŸèƒ½)
```

#### è·¯ç”±é…ç½®

- âœ… `frontend/src/router/index.js` - æ›´æ–°ç‚ºæ–°çš„ agent-management.vue
- âœ… `frontend/src/views/admin/agent-management.vue` - é ç±¤å®¹å™¨é é¢
- âœ… `frontend/src/views/admin/agents.vue` - åŸæœ‰æ™ºèƒ½é«”ç®¡ç†åŠŸèƒ½
- âœ… `frontend/src/views/admin/GlobalPromptManager.vue` - å…¨åŸŸæç¤ºè©ç®¡ç†

#### ç®¡ç†ç•Œé¢åŠŸèƒ½

```javascript
âœ… GlobalPromptManager.vue åŠŸèƒ½ï¼š
- ğŸ“Š çµ±è¨ˆå„€è¡¨æ¿ (è¦å‰‡çµ±è¨ˆã€å¿«å–ç‹€æ…‹ã€ç³»çµ±å¥åº·)
- ğŸ“ è¦å‰‡é è¦½å’Œè¤‡è£½åŠŸèƒ½
- ğŸ§ª ç³»çµ±æç¤ºè©æ¸¬è©¦å·¥å…·
- âš¡ å¿«å–ç®¡ç† (æ¸…é™¤ã€é‡æ–°è¼‰å…¥)
- ğŸ“ˆ å¯¦æ™‚ç›£æ§å’Œç‹€æ…‹é¡¯ç¤º
```

---

## ğŸ”’ å…¨åŸŸè¡Œç‚ºè¦å‰‡

### æ ¸å¿ƒåŸå‰‡

```
ğŸš« çµ•å°ç¦æ­¢çš„è¡Œç‚ºï¼š
1. çµ•å°ä¸å¯ä»¥ç·¨é€ ã€çŒœæ¸¬æˆ–è™›æ§‹ä»»ä½•æ•¸æ“š
2. å¦‚æœå·¥å…·èª¿ç”¨å¤±æ•—ï¼Œå¿…é ˆæ˜ç¢ºå‘ŠçŸ¥ç”¨æˆ¶
3. ä¸å¯ä»¥å°å·¥å…·è¿”å›çš„æ•¸æ“šé€²è¡Œä»»ä½•å‡è¨­æ€§çš„è£œå……
4. ä¸å¯ä»¥æä¾›æœªç¶“å·¥å…·é©—è­‰çš„è³‡è¨Š

âœ… å…è¨±çš„è¡Œç‚ºï¼š
1. åªèƒ½åŸºæ–¼å·¥å…·è¿”å›çš„çœŸå¯¦æ•¸æ“šé€²è¡Œå›ç­”
2. å¯ä»¥è§£é‡‹å’Œåˆ†æå·¥å…·è¿”å›çš„çµæœ
3. å¯ä»¥å»ºè­°ç”¨æˆ¶ä½¿ç”¨å…¶ä»–ç›¸é—œå·¥å…·
4. å¯ä»¥è¦æ±‚ç”¨æˆ¶æä¾›æ›´å¤šè³‡è¨Š
```

### è¦ç¯„ç¯„åœ

- ğŸ› ï¸ å·¥å…·èª¿ç”¨è¦ç¯„ (åƒæ•¸é©—è­‰ã€éŒ¯èª¤è™•ç†ã€çµæœç¢ºèª)
- ğŸ¯ ç”¨æˆ¶é«”é©—è¦ç¯„ (æ¸…æ™°å›æ‡‰ã€çµæ§‹åŒ–è³‡è¨Šã€ä¸»å‹•å»ºè­°)
- ğŸ” å®‰å…¨èˆ‡éš±ç§ (æ•æ„Ÿè³‡æ–™ä¿è­·ã€æ¬Šé™æª¢æŸ¥)

---

## âš¡ æ€§èƒ½æŒ‡æ¨™

### å¿«å–æ€§èƒ½

```
åˆæ¬¡è¼‰å…¥: ~50ms (å«è³‡æ–™åº«æŸ¥è©¢)
å¿«å–å‘½ä¸­: < 10ms (è¨˜æ†¶é«”è®€å–)
å¿«å–éæœŸ: 5åˆ†é˜è‡ªå‹•æ›´æ–°
å‘½ä¸­ç‡: é ä¼° > 95%
```

### æ•´åˆæ€§èƒ½

```
è¦å‰‡é•·åº¦: 2815 å­—ç¬¦
æ•´åˆæ™‚é–“: < 5ms
è¨˜æ†¶é«”ä½¿ç”¨: æœ€å°åŒ– (å…±äº«å¿«å–)
ä½µç™¼æ”¯æ´: ç„¡é™åˆ¶ (åªè®€æ“ä½œ)
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. è¨ªå•ç®¡ç†ç•Œé¢

```
URL: http://localhost:5175/admin/agents
ä½ç½®: é»æ“Šã€Œå…¨åŸŸæç¤ºè©ã€é ç±¤
æ¬Šé™: éœ€è¦ç®¡ç†å“¡èº«ä»½
```

### 2. ç®¡ç†æ“ä½œ

```
ğŸ“Š æŸ¥çœ‹çµ±è¨ˆ: è‡ªå‹•è¼‰å…¥ç³»çµ±ç‹€æ…‹
ğŸ“ é è¦½è¦å‰‡: æŸ¥çœ‹å®Œæ•´çš„å…¨åŸŸè¦å‰‡å…§å®¹
ğŸ§ª æ¸¬è©¦æ•´åˆ: æ¸¬è©¦è¦å‰‡å¦‚ä½•æ•´åˆåˆ°ç³»çµ±æç¤ºè©
âš¡ å¿«å–ç®¡ç†: æ¸…é™¤å¿«å–å¼·åˆ¶é‡æ–°è¼‰å…¥
```

### 3. é–‹ç™¼è€…æ“ä½œ

```
æ›´æ–°è¦å‰‡: ä¿®æ”¹è³‡æ–™åº« system_configs è¡¨
å³æ™‚ç”Ÿæ•ˆ: API å‘¼å«å¾Œè‡ªå‹•æ¸…é™¤å¿«å–
é™ç´šè™•ç†: è³‡æ–™åº«å¤±æ•—æ™‚è‡ªå‹•ä½¿ç”¨é è¨­è¦å‰‡
ç›£æ§æ—¥èªŒ: æ‰€æœ‰æ“ä½œéƒ½æœ‰è©³ç´°æ—¥èªŒè¨˜éŒ„
```

---

## ğŸ§ª æ¸¬è©¦é©—è­‰

### å·²å®Œæˆæ¸¬è©¦

```
âœ… è³‡æ–™åº«é€£æ¥æ¸¬è©¦
âœ… å…¨åŸŸè¦å‰‡è¼‰å…¥æ¸¬è©¦
âœ… å¿«å–æ©Ÿåˆ¶æ¸¬è©¦
âœ… API ç«¯é»æ¸¬è©¦
âœ… å‰ç«¯ç•Œé¢æ¸¬è©¦
âœ… ç³»çµ±æ•´åˆæ¸¬è©¦
```

### æ¸¬è©¦çµæœ

```
ğŸ” è³‡æ–™åº«é…ç½®: âœ… å­˜åœ¨ä¸”æ­£ç¢º (2815 å­—ç¬¦)
âš¡ å¿«å–æ©Ÿåˆ¶: âœ… < 10ms éŸ¿æ‡‰æ™‚é–“
ğŸ”’ è¦å‰‡æ•´åˆ: âœ… è‡ªå‹•æ·»åŠ åˆ°æ‰€æœ‰ç³»çµ±æç¤ºè©
ğŸ“Š çµ±è¨ˆåŠŸèƒ½: âœ… å®Œæ•´çš„ç³»çµ±ç›£æ§
ğŸŒ API ç«¯é»: âœ… æ‰€æœ‰ç®¡ç† API æ­£å¸¸é‹ä½œ
ğŸ’» å‰ç«¯ä»‹é¢: âœ… å®Œæ•´çš„ç®¡ç†åŠŸèƒ½
```

---

## ğŸ¯ ç³»çµ±æ•ˆç›Š

### 1. ä¸€è‡´æ€§ä¿éšœ

- **çµ±ä¸€è¡Œç‚ºè¦ç¯„**: æ‰€æœ‰æ™ºèƒ½é«”éµå®ˆç›¸åŒçš„æ ¸å¿ƒåŸå‰‡
- **æ•¸æ“šçœŸå¯¦æ€§**: åš´æ ¼ç¦æ­¢ AI ç·¨é€ æˆ–è™›æ§‹æ•¸æ“š
- **ç”¨æˆ¶é«”é©—**: æ¨™æº–åŒ–çš„å›æ‡‰æ ¼å¼å’Œäº’å‹•æ–¹å¼

### 2. ç®¡ç†æ•ˆç‡

- **é›¶åœæ©Ÿæ›´æ–°**: ä¿®æ”¹é…ç½®ç„¡éœ€é‡å•Ÿæœå‹™
- **å³æ™‚ç”Ÿæ•ˆ**: API æ›´æ–°å¾Œç«‹å³æ‡‰ç”¨åˆ°æ‰€æœ‰æ™ºèƒ½é«”
- **é›†ä¸­ç®¡ç†**: å–®ä¸€ä»‹é¢ç®¡ç†æ‰€æœ‰è¡Œç‚ºè¦å‰‡

### 3. ç³»çµ±ç©©å®šæ€§

- **æ™ºèƒ½é™ç´š**: è³‡æ–™åº«å¤±æ•—æ™‚è‡ªå‹•ä½¿ç”¨é è¨­è¦å‰‡
- **å¿«å–æ©Ÿåˆ¶**: é«˜æ€§èƒ½è¨˜æ†¶é«”å¿«å–æ¸›å°‘è³‡æ–™åº«è² è¼‰
- **å®Œæ•´æ—¥èªŒ**: æ‰€æœ‰æ“ä½œéƒ½æœ‰è©³ç´°è¨˜éŒ„å’Œç›£æ§

### 4. é–‹ç™¼å‹å¥½

- **æ¨¡çµ„åŒ–è¨­è¨ˆ**: æ¸…æ™°çš„æœå‹™åˆ†å±¤å’Œè·è²¬åˆ†é›¢
- **RESTful API**: æ¨™æº–åŒ–çš„ç®¡ç†ä»‹é¢
- **å®Œæ•´æ–‡æª”**: è©³ç´°çš„ä½¿ç”¨èªªæ˜å’Œæ•…éšœæ’é™¤

---

## ğŸ“š æŠ€è¡“æ£§

### å¾Œç«¯æŠ€è¡“

```
- Node.js + Express.js
- MySQL 8.0 (Docker)
- åŸç”Ÿ SQL æŸ¥è©¢
- JWT èªè­‰
- çµæ§‹åŒ–æ—¥èªŒ
```

### å‰ç«¯æŠ€è¡“

```
- Vue 3 + Composition API
- Ant Design Vue
- Vue Router 4
- Axios HTTP å®¢æˆ¶ç«¯
- éŸ¿æ‡‰å¼è¨­è¨ˆ
```

### åŸºç¤è¨­æ–½

```
- Docker MySQL å®¹å™¨
- 5åˆ†é˜æ™ºèƒ½å¿«å–
- ç’°å¢ƒè®Šæ•¸é…ç½®
- è‡ªå‹•åŒ–æ¸¬è©¦è…³æœ¬
```

---

## ğŸ”® æœªä¾†æ“´å±•

### å¯èƒ½çš„å¢å¼·åŠŸèƒ½

```
1. ğŸ“ è¦å‰‡ç‰ˆæœ¬æ§åˆ¶å’Œæ­·å²è¨˜éŒ„
2. ğŸ¯ ä¸åŒæ™ºèƒ½é«”é¡å‹çš„å·®ç•°åŒ–è¦å‰‡
3. ğŸ“Š æ›´è©³ç´°çš„ä½¿ç”¨çµ±è¨ˆå’Œåˆ†æ
4. ğŸ”„ è¦å‰‡æ›´æ–°çš„ A/B æ¸¬è©¦åŠŸèƒ½
5. ğŸŒ å¤šèªè¨€è¦å‰‡æ”¯æ´
6. ğŸ“± è¡Œå‹•è£ç½®ç®¡ç† App
```

### ç›£æ§å’Œè­¦å ±

```
1. ğŸš¨ è¦å‰‡è¼‰å…¥å¤±æ•—è­¦å ±
2. ğŸ“ˆ æ€§èƒ½æŒ‡æ¨™ç›£æ§
3. ğŸ“Š ä½¿ç”¨é‡çµ±è¨ˆåˆ†æ
4. ğŸ” ç•°å¸¸è¡Œç‚ºæª¢æ¸¬
```

---

## âœ… å®Œæˆç¢ºèª

**ç³»çµ±ç‹€æ…‹**: ğŸ‰ **å®Œå…¨å°±ç·’**

**é©—è­‰é …ç›®**:

- [x] è³‡æ–™åº«é…ç½®æ­£ç¢º
- [x] å¾Œç«¯æœå‹™æ­£å¸¸
- [x] å‰ç«¯ç•Œé¢å®Œæ•´
- [x] API ç«¯é»å¯ç”¨
- [x] å¿«å–æ©Ÿåˆ¶æœ‰æ•ˆ
- [x] è¦å‰‡æ•´åˆæˆåŠŸ
- [x] ç®¡ç†åŠŸèƒ½å®Œæ•´
- [x] æ¸¬è©¦è…³æœ¬é€šé

**ä¸‹ä¸€æ­¥**: ğŸš€ **ç³»çµ±å·²å¯æŠ•å…¥ä½¿ç”¨**

---

## ğŸ“ æ”¯æ´è³‡è¨Š

**æ–‡æª”ä½ç½®**:

- é–‹ç™¼æŒ‡å—: `docs/MCP_å·¥å…·èª¿ç”¨é–‹ç™¼æŒ‡å—.md`
- API æ–‡æª”: Swagger UI (å•Ÿå‹•æœå‹™å¾Œè¨ªå•)
- æ•…éšœæ’é™¤: æœ¬å ±å‘Šçš„æ¸¬è©¦ç« ç¯€

**è¯ç¹«æ–¹å¼**:

- æŠ€è¡“æ”¯æ´: æŸ¥çœ‹æ—¥èªŒæ–‡ä»¶ `backend/logs/app.log`
- å•é¡Œå›å ±: GitHub Issues
- åŠŸèƒ½å»ºè­°: ç”¢å“åœ˜éšŠ

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**: 2024 å¹´ 12 æœˆ 31 æ—¥ 23:15  
**ç‰ˆæœ¬**: SFDA Nexus v1.0.0  
**ç‹€æ…‹**: âœ… **ç”Ÿç”¢å°±ç·’**
